!function(e,t){function n(){function n(e){return N.replaceAll("bing-na-feedback","bing-na-feedback-"+e)}return{showFeedbackButton:function(r){if("true"==C.getQueryParam("na-feedback",t.location.search))try{for(var i=0;i<r.length;i++){var o=r[i].id,a=e.querySelector("#"+r[i].id);a.innerHTML=n(o)+a.innerHTML;var s=e.querySelector("#bing-na-feedback-"+o+"-button"),u=e.querySelector("#bing-na-feedback-"+o+"-undo"),l=e.querySelector("#bing-na-feedback-"+o),d=e.querySelector("#bing-na-feedback-"+o+"-menu");s.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault(),l.style.display="block",d.style.display="block",s.style.display="block",u.removeAttribute("style")}),u.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault(),u.removeAttribute("style"),s.removeAttribute("style"),l.removeAttribute("style")}),d.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault(),console.log(o);var t=o.split("_")[0];if("option"==e.srcElement.getAttribute("feedbacktag")||"option"==e.srcElement.parentElement.getAttribute("feedbacktag")){var n=e.srcElement.parentElement.id;P.addAdProperty(t,o,"feedback",n),D.telemetryServiceV1.getPropertiesAndLogEvent("feedback",t,o),d.removeAttribute("style"),s.style.display="none",u.style.display="block"}}),l.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault(),"block"!=u.style.display&&(l.removeAttribute("style"),s.removeAttribute("style"))})}}catch(e){}}}}function r(e,n,r,i){function o(t,n,u){if(E.naContext=n,L.preAdRetrieval(E),n=E.naContext,E.getAdsPublisherImpl)!(l=E.getAdsPublisherImpl(t,this))||l.length<1?i.logError("No Ads Returned"):u(l);else{var l,p=s(t,n),f=d(E.baseUrl,p,n);"GET"==E.requestType&&f.length>=2e3&&(E.requestType="POST",f=d(E.baseUrl,p,n));var g="object"==typeof n&&n.publisherName&&n.publisherName.toLowerCase()||"unknown";P.addProperty("publisherName",g),i.getPropertiesAndLogEvent("pageview",t.id),e.send(E.requestType,f,"POST"==E.requestType?p:null,function(e,n){try{r.responseReceived(),P.addRequestProperty(t.id,"traceId",a(n)),!(l=c(e,t))||l.length<1?i.logError("No Ads Returned","traceId="+a(n)):u(l),L.postAdRetrieval(l,t,u,o)}catch(e){i.logError("Error parsing AdResponse",e.toString())}},function(e,t,n){i.logError(e,t),r.error({messsage:e,det:t})}),r.requestSent()}}function a(e){var t="";try{t=e.getResponseHeader("BingAPIs-TraceId")}catch(e){}return t||""}function s(e,n){var r=e.query,i=[];if(n.tracingtag){var o=n.tracingtag.split(",");i=i.concat(o)}e.tracingTag&&(i=i.concat(e.tracingTag));var a=unescape(E.contentUrl),s=E.publisherCategory,l=i.length>0?i.join(","):"",d=[],c=[],p=[];e.pageType&&(c=c.concat(e.pageType)),e.category&&(d=d.concat(e.category),c=c.concat(e.category)),p=n.keywords?p.concat(n.keywords):[r],n.pageType&&(c=c.concat(n.pageType)),n.pageCategory&&(d=d.concat(n.pageCategory),c=c.concat(n.pageCategory)),n.userCategory&&(c=c.concat(n.userCategory)),s&&(d=d.concat(s),c=c.concat(s)),d=C.removeDuplicates(d),c=C.removeDuplicates(c),P.addRequestProperty(e.id,"pageType",c.length>0?c[0]:"unknown"),P.addRequestProperty(e.id,"vertical",c.length>1?c[1]:"unknown");var f;return f=n.apikey?{apikey:unescape(n.apikey),tracingtag:l}:{adunitId:n.adUnitId,propertyid:n.propertyId,tracingtag:l},v4Body={query:r,content:[],URL:a,referralURL:null,queryType:"AdsRequest",publisherData:{providerId:l}},v5Body={_type:"Ads/NativeAdsRequest",imp:[{id:C.generateGuid()}],site:{domain:t.location.hostname,cat:d,page:a,keywords:p,publisher:{id:n.publisherId,name:n.publisherName,ext:f},content:{url:a,title:r,cat:u(c),keywords:p}}},4==y?v4Body:v5Body}function u(e){for(var t=[],n=0;n<e.length;n++){var r=l(e[n]);r&&t.push(r)}return t}function l(e){return e?e.replace(" ","").toLowerCase():null}function d(e,n,r){var i,o,a=C.getQueryParams(S,t.location.search),s=e;"GET"==E.requestType&&(s=C.addQueryParam(s,"q",encodeURIComponent(C.JSONstringify(n)))),4!=y&&void 0!=r.appId&&(s=C.addQueryParam(s,"appid",r.appId));for(var u=0,l=a.length;u<l;u++)i=a[u].name.substring(T.length),o=a[u].value,s=C.addQueryParam(s,i,o);return s}function c(e,t){var n,o,a=p(e),s=a&&a.ads||a&&a.adContainers&&1==a.adContainers.length&&a.adContainers[0].ads,u=a&&a.miFeedbackUrl,l=a&&a.mvFeedbackUrl;if(P.addRequestProperty(t.id,"rGuid",a.requestGuid?a.requestGuid:""),!s||!s.length)return null;try{if(a.templates){n=C.JSONparse(a.templates);for(var d in n){var c=n[d],g=c.templateDefinition?C.JSONparse(c.templateDefinition):null;n[d]=g}}a.targets&&(o=C.JSONparse(a.targets))}catch(e){r.error({message:"Error parsing ad response.",det:e.toString()}),i.logError("Error parsing ad response",e.toString())}return f(s,n,o,_,t.id,u,l),L.postParseAdsResponse(o,s,t),s}function p(e){var t=C.JSONparse(e);return t&&"ErrorResponse"!=t._type?t:null}function f(e,t,n,r,i,o,a){for(var s=0,u=e.length;s<u;s++){var l=e[s],d=l.displayUrl;d&&(0===d.indexOf(I)&&(l.displayUrl=d=d.substring(I.length)),l.displayUrlBase=d.substring(0,d.indexOf("."))),l.id=i+"_na-adid-"+s,l.templates=t,l.targets=n,l.miFeedbackUrl=o,l.mvFeedbackUrl=C.createMVFeedbackUrl(l.feedbackToken,a),h(l),v(l),l.defaultFaviconUrl=r}}function g(e,t){var n=t.imageType;n&&(e[n]=t)}function h(e){var t=e.images;if(t)for(var n=0,r=t.length;n<r;n++)g(e,t[n])}function v(e){var t=e.decorations;if(t)for(var n=0,r=t.length;n<r;n++){var i=t[n],o=i._type;if(o&&(e[o]=i,"Ads/MerchantRatingExtension"==o&&null!=i.rating&&void 0!=i.rating&&(i.ratingPercent=i.rating/10*100),"Ads/PaidSearchForNative/PAExtension"==o&&null!=i.dealPrice&&void 0!=i.dealPrice)){var a=parseFloat(i.originalPrice.replace(/[^0-9\.]+/g,"")),s=parseFloat(i.dealPrice.replace(/[^0-9\.]+/g,""));if(!isNaN(a)&&!isNaN(s)){var u=parseInt((a-s)/a*100);u>=5&&(i.discount=u.toString()+"%")}}}}var m=n.getConfig("baseUrl"),_=n.getConfig("defaultFaviconUrl"),y=n.getConfig("apiVersion"),I="www.",T="na-param_",S=new RegExp("^"+T),E={contentUrl:t.location.href,publisherCategory:function(){switch(t.location.host){case"www.marketwatch.com":return C.getMetaContentByName("article.section");default:return null}}(),baseUrl:function(e){return C.addQueryParam(e,"setmkt","en-us")}(m),requestType:n.getConfig("requestType")};return{getAds:o,parseAdsResponse:c,generateRequestBody:s}}function o(){var e={requestType:"GET",baseUrl:"https://www.bing.com/api/beta/v6/ads/native/search",apiVersion:6,defaultFaviconUrl:"https://bing.com/favicon.ico",adChoiceUrl:"https://choice.microsoft.com/en-us",openNewWindow:!0,slidesPerBatch:10,pageContext:{},articleRoot:".articlebody",pageAssetsToScrape:[{name:"pageTitle",targetPath:"head title",type:"text"},{name:"headerBgColor",targetPath:".head",type:"style",styleName:"backgroundColor"}],blacklists:{nodeName:["iframe","script","video","block-quote"],className:["html5player","caption","image","inlineimage","inline-slideshow","gallery","twitter-tweet","wp-caption-text","secondary-title"]},ariaIntToken:"b6e94ecd1b2249329b70e417634bd7d4-c8fb610b-9ede-4ac9-8335-32348f7b1fec-7286",ariaProdToken:"c34cce5c21da4a91907bc59bce4784fb-42e261e9-5073-49df-a2e1-42415e012bc6-6954"};if("undefined"!=typeof configOverrides)for(var t in configOverrides)e[t]=configOverrides[t];return{getConfig:function(t){return e[t]}}}function a(){var e=t.XDomainRequest&&C.isIE9OrLower()?function(e,t,n,r,i){"string"!=typeof n&&(n=C.JSONstringify(n)),"POST"===e&&(e="GET",t+="?q="+encodeURIComponent(n),n=null);var o=new XDomainRequest;o.onerror=function(){i&&i(-1,"xdr error")},o.onload=function(){r(o.responseText)},o.ontimeout=function(){i&&i(-1,"xdr timeout")},o.onprogress=function(){},o.open(e,t),o.send(n)}:function(e,t,n,r,i){"string"!=typeof n&&(n=C.JSONstringify(n));var o=new XMLHttpRequest;o.onreadystatechange=function(){4==o.readyState&&(o.status>=200&&o.status<300?r(o.responseText,o):i&&i(o.status,o.responseText,o))},o.open(e,t,!0),o.withCredentials=!0,o.setRequestHeader("Accept","*/*"),o.send(n)};return{get:function(t,n,r){e("GET",t,null,n,r)},post:function(t,n,r,i){e("POST",t,n,r,i)},send:e}}function s(e,t){return{getContentSnippet:function(e,n){if(!e)return null;var r,i;switch(e.type){case"textPath":i=(r=C.getNode(t,e.path,e.nthOfPath))&&r.textContent;break;case"htmlPath":i=(r=C.getNode(t,e.path,e.nthOfPath))&&r.innerHTML;break;default:i=e.value}return i?{targetId:n,extractionType:e.type,content:i}:null},scrapePageAssets:function(){for(var n=e.getConfig("pageContext"),r=e.getConfig("pageAssetsToScrape"),i=0,o=r.length;i<o;i++){var a=r[i],s=C.getNode(t,a.targetPath);if(s)switch(a.type){case"text":n[a.name]=s.textContent;break;case"style":n[a.name]=C.getComputedStyle(s).getPropertyValue(a.styleName)}}}}}function u(e){function t(){var t=new A.applications.telemetry.LogConfiguration;t.enableAutoUserSession=!0,C.isDebug()?A.applications.telemetry.LogManager.initialize(e.getConfig("ariaIntToken"),t):A.applications.telemetry.LogManager.initialize(e.getConfig("ariaProdToken"),t),ariaEventLogger=new A.applications.telemetry.Logger}ariaEventLogger=null,this.logEvent=function(e,n){ariaEventLogger||t();var r=new A.applications.telemetry.EventProperties;r.name=e;for(var i in n)n[i]&&r.setProperty(i,n[i].toString());ariaEventLogger.logEvent(r)},this.getGuid=function(){return A.applications.telemetry.datamodels.utils.GetGuid()}}function l(t){function n(){}function r(){t&&t([l],function(e){u=e})}function i(e,r){var a,s=this,u=!1;if(r=r||0,!t)return this.log=this.flush=n,void(o=[]);t([d],function(t){if(t&&(a=t.telemetryTracking,u=t.sitePage&&t.sitePage.pageUrl&&a&&a.setupParameters&&a.sendUpdate),u)e&&e(a);else{if(++r<10)return void setTimeout(function(){i(e,r)},500);s.log=s.flush=n,o=[]}})}var o=[],a="",s=!1,u=null,l="track",d="trackInfo",c="naimpr_update";return setTimeout(function(){r()},0),{log:function(e){e&&o.push(e)},flush:function(e){i(function(t){if(t&&o.length){for(var n,r,i=[];n=o.shift();)i.push(n);(r=t.setupParameters(e||c)).data={evts:i,adRid:a},t.sendUpdate(r),s=!0}})},userNavigation:function(){!s&&u&&u.trackEvent&&(e.createElement("div").innerText=c)},setRId:function(e){a=e},adClicked:function(e,n,r){t&&t([l],function(t){var i={adRid:a,apptitle:r.title};t.trackEvent({type:"click",target:n},n,e,C.JSONstringify(i))})}}}function d(e){function t(t,n,o){var a=i.length>0?i[i.length-1]:null,s=Date.now();if(i.push({name:t,time:s}),e&&e.log&&a){var u={name:t,value:s-a.time};n&&(u.det=r),o&&(u.errDet=o),e.log(u)}}function n(t){e&&e.flush&&e.flush(t)}var r={off:{},artProps:{}},i=[],o=[{type:"start",name:"start"},{type:"requestSent",name:"req"},{type:"responseReceived",name:"res"},{type:"finished",name:"fin",flush:!0,addDetails:!0},{type:"error",name:"err",flush:!0}],a=["userNavigation","setRId","adClicked"];this.recordOffset=function(e,t,n,i,o){r.off[e]={val:t,rsn:n,rsnArr:i,depth:o}},this.recordArticleHeight=function(e){r.artProps.heightPx=e};for(var s=0,u=o.length;s<u;s++){var l=o[s];this[l.type]=function(e){return function(r){t(e.name,e.addDetails,r),e.flush&&n()}}(l)}for(var s=0,u=a.length;s<u;s++){var d=a[s];this[d]=e&&e[d]||function(){}}}function c(e){function t(e,t){for(var n in t)e[n]=t[n];return e}function n(e,t){return a(["host","naClientGuid","naClientVersion","referrer","screenHeight","screenWidth","url","userAgent","publisherName","msnImprId"],e?{id:e,properties:["pageType","vertical","tracingTag"]}:null,null)}function r(e,t){return a(["host","naClientGuid","naClientVersion","url","publisherName"],e?{id:e,properties:["traceId","rGuid","pageType","vertical"]}:null,t?{id:t,properties:["type","target","template","inserted"]}:null)}function o(e,t){return r(e,t)}function a(e,t,n,r){var o,a,s,u={};s=e;for(i in s)u[s[i]]=P.data[s[i]];if(t){o=t.id,s=t.properties;for(i in s)try{u[s[i]]=P.data.adRequests[o][s[i]]}catch(e){}}if(n){a=n.id,s=n.properties;for(i in s)try{u[s[i]]=P.data.adRequests[o].ads[a][s[i]]}catch(e){}}if(r){s=r;for(i in s)try{u[s[i]]=P.data.adRequests[o].latency[s[i]]}catch(e){}}return u}var s={publisherpageview:function(){var e=n();return t(a(["msnaselected","publisherpagetype","msnRequestList","msnNativeAdData","nativeAdsContext","adcallCount","msnImprId","enableMIMVLogging"],null,null),e)},pageview:n,adimpression:r,adclick:function(e,t){return a(["host","naClientGuid","naClientVersion","url","publisherName"],e?{id:e,properties:["traceId","rGuid","pageType","vertical"]}:null,t?{id:t,properties:["type","target","template","isClickTrusted"]}:null)},adview:o,partialadview:o,feedback:function(e,t){return a(["host","naClientGuid","naClientVersion","url","publisherName"],e?{id:e,properties:["traceId","rGuid","pageType","vertical"]}:null,t?{id:t,properties:["type","target","template","inserted","title","targetUrl","images","feedback"]}:null)},latency:function(e,t){var n=a(["host","naClientGuid","naClientVersion","referrer","url","userAgent","publisherName"],e?{id:e,properties:["traceId","rGuid","pageType","vertical"]}:null,null,["adcall","total"]);return parseInt(n.total)>1e4?null:n},usernavigation:n,error:function(){return a(["host","naClientGuid","naClientVersion","referrer","url","userAgent","publisherName","message","details"],null,null)},retryadcall:n,miFeedback:function(e,n){return t(a(["miFeedbackUrl"],null,null),r(e,n))},mvFeedback:function(e,t){return a(["host","naClientGuid","naClientVersion","url","publisherName"],e?{id:e,properties:["traceId","rGuid","pageType","vertical"]}:null,t?{id:t,properties:["type","target","template","inserted","mvFeedbackUrl"]}:null)}};this.getGuid=function(){return e.getGuid()},this.getPropertiesAndLogEvent=function(e,t,n){try{if(s[e]){var r=s[e](t,n);r&&this.logEvent(e,r)}}catch(e){C.consoleLog("Error getting properties"+e.toString())}},this.logEvent=function(t,n){try{e.logEvent(t,n),C.isDebug()&&C.consoleLog("TelemetryEvent: "+t+" "+C.JSONstringify(n))}catch(e){C.consoleLog("BingAds script failed to log telemetry event."+e.toString())}},this.logError=function(e,t){P.addProperty("message",e),P.addProperty("details",t),this.getPropertiesAndLogEvent("error")}}function p(n,r){h();var i={requestObj:g(e,r),targetDocument:e,targetWindow:t,enableMIMVLogging:w,naContext:n};return L.preInitialize(i),D=f(i.targetDocument),P.addProperty("naClientGuid",D.telemetryServiceV1.getGuid()),i}function f(e){var t={};return t.configService=new o,t.ariaInstrumentationService=new u(t.configService),t.telemetryServiceV1=new c(t.ariaInstrumentationService),t.extractionService=new s(t.configService,e),t.httpService=new a,t.templateRenderingService=new I(t.configService,e,t.telemetryServiceV1),t.targetingService=new y(t.templateRenderingService,e,null,t.configService,t.telemetryServiceV1),t.instrumentationService=new l("undefined"==typeof require?null:require),t.telemetryService=new d(t.instrumentationService),t.adRetrievalService=new r(t.httpService,t.configService,t.telemetryService,t.telemetryServiceV1),t.adFeedbackService=new n,t.templateRenderingService.setTelemetryService(t.telemetryService),t.targetingService.setTelemetryService(t.telemetryService),t}function g(e,t){var n=e.title;n=n||"empty";var r={};return r.requestList=[],r.requestList.push({id:"default"+t,query:n}),r.requestListPopulated=!0,r}function h(){if("undefined"==typeof jQuery)try{C.loadScript("https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.1.0.min.js",function(){na_jQuery=jQuery.noConflict(!0),initializeAppear(na_jQuery)})}catch(e){D.telemetryServiceV1.logError("Couldn't insert jquery",e)}else na_jQuery=jQuery,initializeAppear(na_jQuery)}function v(e){x+=1,e&&e.pageType&&P.addProperty("publisherpagetype",e.pageType);var n=p(e,x),r=n.targetDocument,i=n.targetWindow,o=n.requestObj;w=n.enableMIMVLogging,e=n.naContext;try{if(C.consoleLog(t.naClientVersion),"function"==typeof selectAndLoadAdScript&&!selectAndLoadAdScript())return P.addProperty("msnaselected",!1),void D.telemetryServiceV1.getPropertiesAndLogEvent("publisherpageview");w&&P.addProperty("enableMIMVLogging",!0),P.addProperty("msnaselected",!0),i.addEventListener("unload",function(){D.telemetryService.userNavigation(),D.telemetryServiceV1.getPropertiesAndLogEvent("usernavigation")}),D.extractionService.scrapePageAssets(r),O=r;var a=setInterval(function(){if(o.requestListPopulated){D.telemetryServiceV1.getPropertiesAndLogEvent("publisherpageview"),clearInterval(a);for(var t=0,n=o.requestList.length;t<n;t++){var s=o.requestList[t];m(r,i,s,D.targetingService,D.adRetrievalService,D.telemetryService,D.extractionService,D.configService,D.adFeedbackService,D.telemetryServiceV1,e)}L.postInitialize()}},250)}catch(e){D.telemetryServiceV1.logError("Initialize failed",e.toString())}}function m(e,t,n,r,i,o,a,s,u,l,d){o.start();var c=n.query;try{var p=(new Date).getTime();B.push(c),i.getAds(n,d,function(i){if(P.addLatencyProperty(n.id,"adcall",(new Date).getTime()-p),i&&i.length){var a=i[0].targets&&i[0].targetId&&i[0].targets[i[0].targetId]?i[0].targets[i[0].targetId].articleRoot:"";r.createPageModel(a),r.insertEntities(i,n.id),u.showFeedbackButton(i),R.initialize(i,t),_(e,o,s,a)}P.addLatencyProperty(n.id,"total",(new Date).getTime()-p),l.getPropertiesAndLogEvent("latency",n.id),o.finished()})}catch(e){o.error({message:"Unknown Error",det:e.toString()}),D.telemetryServiceV1.logError("Unknown Error",e.toString())}}function _(e,t,n,r){var i=C.checkAndGetNode(e,n.getConfig("articleRoot"),r);i&&t.recordArticleHeight(i.offsetHeight)}function y(n,r,o,a,s){function u(e,t,n,i){if(!n)return!0;if(!t.getBoundingClientRect)return!1;var o=k(e)||"top",a=t.getBoundingClientRect()[o],s=(n.path&&C.getNode(r,n.path,e.nthOfPath)||t.parentNode).getBoundingClientRect()[i],u=n.value;return!(u&&Math.abs(s-a)<u)}function l(e,t){if(!t)return!0;if(!e.getBoundingClientRect)return!1;var n=e.getBoundingClientRect(),r=t.value,i=n.bottom-n.top;return!(r&&Math.abs(i)<r)||!("overflow"!=t.mode||!t.className)&&d(e,i,r,t.className)}function d(e,t,n,o){var a=r.getElementsByClassName(o)[0].childNodes;for(i=0;i<a.length;i++)if(a[i].innerHTML==e.innerHTML&&null!=a[++i])return c(i,a,t,n);return!1}function c(e,t,n,r){for(j=e;j<t.length;j++){if("[object HTMLParagraphElement]"!=String(t[j]))return!1;var i=t[j].getBoundingClientRect(),o=i.bottom-i.top+n;if(r&&Math.abs(o)>=r)return!0;n=o}}function p(t,r){var i=e.createDocumentFragment();return n.renderTemplate(t,i),i}function f(e,t,n,r){var i=null;if(e.paraNo){var o=e.paraNo+(r||0);i=te.paras.length>=o&&te.paras[o-1]||te.paras.length>0&&(0==r||void 0===r)&&te.paras[te.paras.length-1]}else i=C.getNode(O,e.path,e.nthOfPath);return n?i:B(t,e,i)}function g(e,t,n,r){e.setAttribute("na-entityinserted_"+n.id,!0),ee.push(n.id),L.postEntityInsertion(t,r)}function h(e,t){var n=f(t,e);if(!n)return!1;var r=p(e,t),i=C.copyArray(r.childNodes);return n.appendChild(r),g(n,i,t,e),!0}function v(e,t){return _(e,t,"before")}function m(e,t){return _(e,t,"after")}function _(e,t,n){var r=f(t,e);if(!r)return!1;var i=r.parentNode,o="before"===n?r:r.nextSibling,a=p(e,t),s=C.copyArray(a.childNodes);return i.insertBefore(a,o),g(i,s,t,e),!0}function y(e,t){var n=p(e,t),r=C.copyArray(n.childNodes),i=f(t,e);if(0==r.length||!i)return!1;var o=i.parentNode;return o.replaceChild(n,i),g(o,r,t,e),!0}function I(e,t){var n=p(e,t),r=C.copyArray(n.childNodes),i=f(t,e);if(0==r.length||!i)return!1;for(r[0].getAttribute("na-parent-class")&&(i.className=r[0].getAttribute("na-parent-class"));i.firstChild;)i.removeChild(i.firstChild);return i.appendChild(n,i),!0===t.removeClasses&&(i.className=""),g(i,r,t,e),!0}function T(e,t){var n=S(e);P.addAdProperties(t,e.id,n)}function S(e){var t={};try{if(t.target=e.targetId,t.template=e.templateId,t.type=e._type,t.title=e.title,t.targetUrl=e.targetUrl,t.inserted=e.inserted,t.mvFeedbackUrl=e.mvFeedbackUrl,e.images){t.images="";for(var n=0;n<e.images.length;n++)"Favicon"!=e.images[n].imageType&&(t.images+=e.images[n].imageUrl+";")}}catch(e){}return t}function E(e,t){var n=e.targets&&e.targets[t]||e.targets[t];if(n&&(n.id=t,n.fallbackTargetId&&!f(n,null,!0))){var r=E(e,n.fallbackTargetId);if(r)return r.originalTargetId=t,r.blockTemplateId=n.blockTemplateId,r}return n}function A(e,t){var n=t&&t.blockId||"none";if(-1==$.indexOf(n)){$.push(n);var r=E(e,n);b({id:n,templateId:r.blockTemplateId,targetId:n,targets:e.targets,templates:e.templates},r)}}function N(){for(var e=C.getAllNodes(r,"[id^=nablock-]"),t=0,n=e.length;t<n;t++){var i=e[t],o=C.getNode(i,".itemContainer",i.nthOfPath);o&&0!=o.childNodes.length||i.parentNode.removeChild(i)}}function R(e,t){var n=e.target||(e.target=E(e,e.targetId)),r=t.target||(t.target=E(t,t.targetId));return!n||!r||(void 0===n.insertionOrder&&(n.insertionOrder=Number.MAX_VALUE),void 0===r.insertionOrder&&(r.insertionOrder=Number.MAX_VALUE),n.insertionOrder-r.insertionOrder)}function b(e,t){if(!e||!t)return!1;switch(t.insertionMethod){case"replace":return y(e,t);case"before":return v(e,t);case"after":return m(e,t);case"replaceContent":return I(e,t);default:return h(e,t)}}function B(e,t,n){var r=null,i=D(n,t.articleRoot),o={reasons:0,reasonArray:[]};if(!e||!t)return null;if(t.blockId)r=Y[t.blockId].value,o.reasons=Y[t.blockId].reasons,o.reasonArray=Y[t.blockId].reasonArray,i=Y[t.blockId].targetNodeDepth;else if(n){for(r=0;!x(n,t,r,o);)if(r++,!(n=t.paraNo?f(t,null,!0,r):n.nextSibling)){r=null;break}}else r=null,o.reasons=X.targetNodeNotFound;return Y[t.id]={value:r,reasons:o.reasons,reasonArray:o.reasonArray,targetNodeDepth:i},-1==$.indexOf(t.id)&&(t.originalTargetId?Z.recordOffset(t.originalTargetId,-1,o.reasons,o.reasonArray,i):Z.recordOffset(t.id,r,o.reasons,o.reasonArray,i)),n}function D(e,t){for(var n=0,i=e,o=C.checkAndGetNode(r,a.getConfig("articleRoot"),t);i!=o;){if(!i||!o)return-1;i=i.parentNode,n++}return n}function x(e,t,n,r){var i=t.layoutRules;if(i)for(var o in i){var a=i[o],s=J[o];if(s&&!s(t,e,a))return C.consoleLog(t.id+": skipping offset "+n+" due to rule "+o),r.reasonArray.push(X[o]),r.reasons|=X[o],!1}return!0}function k(e){var t=null;switch(e.insertionMethod){case"before":t="top";break;case"after":t="bottom"}return t}function V(e,t,n,i){var o=C.getAllNodes(r,t);return Array.prototype.some.call(o,U,{targetNode:e,minDistance:n,overlapTestPosition:i})}function U(e,t,n){return G(e,this.targetNode,this.minDistance,null,this.overlapTestPosition)}function M(e,t,n){var i=C.getAllNodes(r,t+" *");return Array.prototype.some.call(i,W,{targetNode:e,overlapTestPosition:n})}function W(e,n,r){return"left"==t.getComputedStyle(e).getPropertyValue("float")&&G(e,this.targetNode,0,null,this.overlapTestPosition)}function G(e,t,n,r,i){if(!(e&&e.getBoundingClientRect&&t&&t.getBoundingClientRect))return!0;var o,a,s,u;try{return void 0===n||null===n||isNaN(n)?n=200:n<0&&(n=0),o=F(r,e.getBoundingClientRect()),a=F(i,t.getBoundingClientRect()),s=!(o.left>a.right||o.right<a.left),u=!(o.top>a.bottom+n||o.bottom+n<a.top),!(!s||!u)}catch(e){return!0}}function F(e,t){switch(t=C.copyObject(t),e){case"top":t.bottom=t.top;break;case"bottom":t.top=t.bottom;break;case"left":t.right=t.left;break;case"right":t.left=t.right}return t}function q(e,t){if(e&&!H(e))if(z(e))t.push(e);else{var n=e.childNodes;if(n)for(var r=0,i=n.length;r<i;r++)q(n[r],t)}}function z(e){return void 0!==e.tagName&&"p"==e.tagName.toLowerCase()&&e.clientHeight>0&&!H(e)||1==e.nodeType&&e.offsetHeight>0&&K(e,!0)&&e.textContent&&e.textContent.trim().length>50}function K(e,t){switch(e.nodeType){case 1:if(!t&&!Q(e)||H(e))return!1;break;case 3:case 8:return!0;default:return!1}var n=e.childNodes;if(n)for(var r=0,i=n.length;r<i;r++)if(!K(n[r]))return!1;return!0}function Q(e){if(!e||1!=e.nodeType)return!1;var t=C.getComputedStyle(e).display||"";return t=t.toLowerCase(),-1!=["inline","inline-block"].indexOf(t)}function H(e){var t=(e.nodeName||"").toLowerCase(),n=(e.className||"").split(" ");if(-1!=ne.nodeName.indexOf(t))return C.consoleLog("blacklisted "+t),!0;for(var r=0,i=n.length;r<i;r++){var o=n[r];if(-1!=ne.className.indexOf(o))return C.consoleLog("blacklisted "+o),!0}return!1}var J={minDistanceFromTop:function(e,t,n){return u(e,t,n,"top")},minDistanceFromBottom:function(e,t,n){return u(e,t,n,"bottom")},avoidFloatingNodesUnder:function(e,t,n){return!(n&&t.nextSibling&&M(t,n.path,k(e)))},avoidOtherAds:function(e,t,n){return!(n&&V(t,n.path,n.minDistance,k(e)))},paraHeight:function(e,t,n){return l(t,n)}},X={minDistanceFromTop:1,minDistanceFromBottom:2,avoidOtherAds:4,avoidFloatingNodesUnder:8,targetNodeNotFound:16,paraHeight:32},Z=o,Y={},$=["none"],ee=[],te={paras:[]},ne=a.getConfig("blacklists");return{insertEntity:h,insertEntityBefore:v,insertEntityAfter:m,replaceWithEntity:y,insertEntities:function(e,t){if(e&&0!==e.length)try{e.sort(function(e,t){return R(e,t)});for(var n=[],r=0,i=e.length;r<i;r++){try{var o=e[r],a=E(o,o.targetId);o.inserted=!1,a&&-1==ee.indexOf(a.id)&&(A(o,a),o.inserted=b(o,a)),T(o,t)}catch(t){Z.error({message:"Error inserting entity.",det:"Entity: "+e[r].toString()+". Exception: "+t.toString()}),s.logError("Error inserting entity.","Entity: "+e[r].toString()+". Exception: "+t.toString())}n.push(o.feedbackToken),s.getPropertiesAndLogEvent("adimpression",t,o.id)}w&&(C.sendImpressionFeedback(n,e[0].miFeedbackUrl),s.getPropertiesAndLogEvent("miFeedback",t,o.id)),N()}catch(e){Z.error({message:"Error inserting entities.",det:e.toString()}),s.logError("Error inserting entities.",e.toString())}},setTelemetryService:function(e){Z=e},createPageModel:function(e){var t=C.checkAndGetNode(r,a.getConfig("articleRoot"),e);try{q(t,te.paras)}catch(e){Z.error({message:"Error creating page model.",det:e.toString()}),s.logError("Error creating page model.",e.toString())}for(var n=0,i=te.paras.length;n<i;n++)C.consoleLog("para"+(n+1)+": "+te.paras[n].textContent)},createPageModelForMultiArticle:function(e,t){var n=C.checkAndGetNode(t,a.getConfig("articleRoot"),e);O=t;try{q(n,te.paras)}catch(e){Z.error({message:"Error creating page model.",det:e.toString()}),s.logError("Error creating page model.",e.toString())}for(var r=0,i=te.paras.length;r<i;r++)C.consoleLog("para"+(r+1)+": "+te.paras[r].textContent)}}}function I(n,r,i){function o(e){var t;return e.templates&&(t=e.templates[e.templateId]),t}function a(e,t,n){switch(t.nodeType){case Node.TEXT_NODE:t.nodeValue=l(e,t.nodeValue);break;case Node.ELEMENT_NODE:s(e,t,n)}return t}function s(e,t,n){var r=C.copyArray(t.childNodes);u(e,t,n);for(var i=0,o=r.length;i<o;i++)a(e,r[i],n)}function u(e,t,n){for(var r,i,o=C.copyArray(t.attributes),a=0,s=o.length;a<s;a++)i=o[a],(r=m[i.name])?r(e,t,i,n):i.value=l(e,i.value)}function l(e,t){if(e)for(var n,r=/[\{]+([^\{\}\@]+)[\}]+|\@([\w\.\/\[\]]+)/g;null!==(n=r.exec(t));){var i=n[1]||n[2];if(-1===f.indexOf(i)){var o=v(e,i),a=typeof o;"string"!==a&&"number"!==a||(t=t.substring(0,n.index)+o+t.substring(r.lastIndex),r.lastIndex+=o.length-n[0].length)}}return t}function d(e,t){var n=t?Object.create(t):{};for(var r in e)n[r]=e[r];return n}function c(t){var n=e.createElement("div");return n.innerHTML=t,n.childNodes}function p(e,t){var n=e.templateComponents;if(n)for(var r=0,i=n.length;r<i;r++){var o=v(t,n[r]);switch(typeof o){case"undefined":return!1;case"object":if(null===o)return!1;if(o&&o.constructor===Array&&o.length<=0)return!1}}return!0}var f=["templateId","targetId"],g=n.getConfig("openNewWindow")?"_blank":"_self",h=n.getConfig("adChoiceUrl"),v=C.resolveMember,m={"na-repeat-set":function(t,n,r){var i,o=e.createDocumentFragment(),s=v(t,r.value),u=parseInt(n.getAttribute("na-repeat-max-items")),l=!isNaN(u)&&u>0?Math.min(u,s.length):s.length;n.removeAttribute(r.name),n.removeAttribute("na-repeat-max-items");for(var c=0;c<l;c++)s[c].index=c+1,i=n.cloneNode(!0),a(d(s[c],t),i),o.appendChild(i);n.parentNode.replaceChild(o,n)},"na-target-url":function(e,n,r){var i=l(e,r.value),o=0==i.indexOf("http")?g:"_self";n instanceof HTMLAnchorElement&&(n.href=i,n.target=o),C.addEventListener(n,"click",function(e){e.stopPropagation(),e.preventDefault(),t.open(i,o);for(var r=n;r&&void 0!=r.id&&r.id.indexOf("na-adid-")<0;)r=r.parentNode;if(r&&void 0!=r.id){var a=r.id,s=a.split("_")[0];P.addAdProperty(s,a,"isClickTrusted","true"),D.telemetryServiceV1.getPropertiesAndLogEvent("adclick",s,a)}})},"na-adchoice":function(e,n,r){var i=h;n instanceof HTMLAnchorElement&&(n.href=i,n.target="_blank"),C.addEventListener(n,"click",function(e){e.stopPropagation(),e.preventDefault(),t.open(h,"_blank")})},"na-grid-set":function(t,n,r){var i=v(t,r.value);if(i&&i.length&&n&&n.childNodes.length){var o,s,u=n.firstChild,l=parseInt(n.getAttribute("na-grid-columns")),c=parseInt(n.getAttribute("na-grid-max-items")),p=!isNaN(c)&&c>0?Math.min(c,i.length):i.length;(isNaN(l)||l<1)&&(l=1),o=Math.ceil(p/l),(s=e.createElement("table")).style.width="100%",s.style.tableLayout="fixed";for(var f=0;f<o;f++){var g=s.insertRow();g.style.backgroundColor="transparent",g.style.padding=0;for(var h=0;h<l;h++){var m=h*o+f;if(!(m>=p)){var _=i[m],y=u.cloneNode(!0);_.index=m+1,a(d(_,t),y);var I=g.insertCell(-1);I.style.padding=0,I.appendChild(y)}}}n.replaceChild(s,u)}},"na-src":function(e,t,n){var r=l(e,n.value);t.src=r},"na-show-on-click":function(e,t,n,r){C.addEventListener(t,"click",function(e){C.getNode(r,n.value).style.display="block"})},"na-hide-on-click":function(e,t,n,r){C.addEventListener(t,"click",function(e){C.getNode(r,n.value).style.display="none"})},"na-show-pa-discount":function(e,t,n){e["Ads/PaidSearchForNative/PAExtension"].discount&&(t.className=t.className.replace("donotshowdiscount",""))},"na-img-size":function(e,t,n){try{if(-1!=unescape(t.src).indexOf("{"))return;var r=C.removeQueryParam(t.src,"w");r=C.removeQueryParam(r,"h");var i=n.value.split("x")[0],o=n.value.split("x")[1];r=C.addQueryParam(r,"w",i),r=C.addQueryParam(r,"h",o),t.src=r}catch(e){C.consoleLog(e)}}},_=i;return{renderTemplate:function(e,t){var r,i=o(e);if(e=d(e,n.getConfig("pageContext")),i&&i.html&&p(i,e)){r=c(i.html),C.AddTagToElement(r[0],"bing-na",e.id),r[0].id=e.id,r[0].classList.add("bing-native-ad");for(var s=r.length-1;s>=0;s--)t.appendChild(a(e,r[s],r[s]))}},setTelemetryService:function(e){_=e}}}t.naClientVersion="8.15.7";var T;(T||(T={})).version="2.7.1";!function(e){!function(e){!function(e){e[e.BT_STOP=0]="BT_STOP",e[e.BT_STOP_BASE=1]="BT_STOP_BASE",e[e.BT_BOOL=2]="BT_BOOL",e[e.BT_UINT8=3]="BT_UINT8",e[e.BT_UINT16=4]="BT_UINT16",e[e.BT_UINT32=5]="BT_UINT32",e[e.BT_UINT64=6]="BT_UINT64",e[e.BT_FLOAT=7]="BT_FLOAT",e[e.BT_DOUBLE=8]="BT_DOUBLE",e[e.BT_STRING=9]="BT_STRING",e[e.BT_STRUCT=10]="BT_STRUCT",e[e.BT_LIST=11]="BT_LIST",e[e.BT_SET=12]="BT_SET",e[e.BT_MAP=13]="BT_MAP",e[e.BT_INT8=14]="BT_INT8",e[e.BT_INT16=15]="BT_INT16",e[e.BT_INT32=16]="BT_INT32",e[e.BT_INT64=17]="BT_INT64",e[e.BT_WSTRING=18]="BT_WSTRING",e[e.BT_UNAVAILABLE=127]="BT_UNAVAILABLE"}(e.BondDataType||(e.BondDataType={})),e.BondDataType,function(e){e[e.MARSHALED_PROTOCOL=0]="MARSHALED_PROTOCOL",e[e.MAFIA_PROTOCOL=17997]="MAFIA_PROTOCOL",e[e.COMPACT_PROTOCOL=16963]="COMPACT_PROTOCOL",e[e.JSON_PROTOCOL=21322]="JSON_PROTOCOL",e[e.PRETTY_JSON_PROTOCOL=20554]="PRETTY_JSON_PROTOCOL",e[e.SIMPLE_PROTOCOL=20563]="SIMPLE_PROTOCOL"}(e.ProtocolType||(e.ProtocolType={})),e.ProtocolType}(e.Bond||(e.Bond={}))}(S||(S={}));!function(e){!function(e){!function(e){var t=function(){function e(){this._buffer=[]}return e.prototype.Add=function(e){for(var t=0;t<this._buffer.length&&this._buffer[t]!=e;++t);t==this._buffer.length&&this._buffer.push(e)},e.prototype.Count=function(){return this._buffer.length},e.prototype.GetBuffer=function(){return this._buffer},e}();e.Set=t;var n=function(){function e(){this._buffer=[]}return e.prototype.Add=function(e,t){-1==this._getIndex(e)&&this._buffer.push({Key:e,Value:t})},e.prototype.AddOrReplace=function(e,t){var n=this._getIndex(e);n>=0?this._buffer[n]={Key:e,Value:t}:this._buffer.push({Key:e,Value:t})},e.prototype.Remove=function(e){var t=this._getIndex(e);t>=0&&this._buffer.splice(t,1)},e.prototype.Count=function(){return this._buffer.length},e.prototype.GetBuffer=function(){return this._buffer},e.prototype.ContainsKey=function(e){return this._getIndex(e)>=0},e.prototype.Get=function(e){var t=this._getIndex(e);return t>=0?this._buffer[t].Value:null},e.prototype._getIndex=function(e){for(var t=0,n=-1;t<this._buffer.length;++t)if(this._buffer[t].Key==e){n=t;break}return n},e}();e.Map=n}(e.Collections||(e.Collections={}))}(e.Bond||(e.Bond={}))}(S||(S={}));!function(e){!function(t){!function(e){var r=function(){function e(){}return e.GetBytes=function(e){for(var t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?t.push(192|r>>6,128|63&r):r<55296||r>=57344?t.push(224|r>>12,128|r>>6&63,128|63&r):(r=65536+((1023&r)<<10|1023&e.charCodeAt(++n)),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return t},e}();e.Utf8=r;var i=function(){function e(){}return e.GetString=function(e){var t,n,r,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=[],a=e.length%3;for(t=0,r=e.length-a;t<r;t+=3)n=(e[t]<<16)+(e[t+1]<<8)+e[t+2],o.push(function(e){return[i.charAt(e>>18&63),i.charAt(e>>12&63),i.charAt(e>>6&63),i.charAt(63&e)].join("")}(n));switch(a){case 1:n=e[e.length-1],o.push(i.charAt(n>>2)),o.push(i.charAt(n<<4&63)),o.push("==");break;case 2:n=(e[e.length-2]<<8)+e[e.length-1],o.push(i.charAt(n>>10)),o.push(i.charAt(n>>4&63)),o.push(i.charAt(n<<2&63)),o.push("=")}return o.join("")},e}();e.Base64=i;var o=function(){function e(){}return e.GetBytes=function(e){for(var t=[];4294967168&e;)t.push(127&e|128),e>>>=7;return t.push(127&e),t},e}();e.Varint=o;var a=function(){function e(){}return e.GetBytes=function(e){for(var t=e.low,n=e.high,r=[];n||4294967168&t;)r.push(127&t|128),t=(127&n)<<25|t>>>7,n>>>=7;return r.push(127&t),r},e}();e.Varint64=a;var s=function(){function e(){}return e.GetBytes=function(e){if(t.BrowserChecker.IsDataViewSupport()){var r=new DataView(new ArrayBuffer(4));r.setFloat32(0,e,!0);for(var i=[],o=0;o<4;++o)i.push(r.getUint8(o));return i}return n.ConvertNumberToArray(e,!1)},e}();e.Float=s;var u=function(){function e(){}return e.GetBytes=function(e){if(t.BrowserChecker.IsDataViewSupport()){var r=new DataView(new ArrayBuffer(8));r.setFloat64(0,e,!0);for(var i=[],o=0;o<8;++o)i.push(r.getUint8(o));return i}return n.ConvertNumberToArray(e,!0)},e}();e.Double=u;var l=function(){function e(){}return e.EncodeZigzag16=function(e){return(e=t.Number.ToInt16(e))<<1^e>>15},e.EncodeZigzag32=function(e){return(e=t.Number.ToInt32(e))<<1^e>>31},e.EncodeZigzag64=function(e){var n=e.low,r=e.high,i=r<<1|n>>>31,o=n<<1;2147483648&r&&(i=~i,o=~o);var a=new t.UInt64("0");return a.low=o,a.high=i,a},e}();e.Zigzag=l}(t.Encoding||(t.Encoding={}));!function(r){var i=function(){function e(){}return e.GetString=function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];if(r<=191)t.push(String.fromCharCode(r));else if(r<=223){i=e[++n];t.push(String.fromCharCode((31&r)<<6|63&i))}else if(r<=239){var i=e[++n],o=e[++n];t.push(String.fromCharCode((15&r)<<12|(63&i)<<6|63&o))}else r=(7&r)<<18|(63&(i=e[++n]))<<12|(63&(o=e[++n]))<<6|63&e[++n],r-=65536,t.push(String.fromCharCode(55296|r>>10&1023)),t.push(String.fromCharCode(56320|1023&r))}return t.join("")},e}();r.Utf8=i;var o=function(){function e(){}return e.GetBytes=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=[],r=0;r<e.length;++r){var i=t.indexOf(e.charAt(r++)),o=t.indexOf(e.charAt(r++)),a=t.indexOf(e.charAt(r++)),s=t.indexOf(e.charAt(r));n.push(i<<2|o>>4),a>=0&&(n.push(o<<4&240|a>>2),s>=0&&n.push(a<<6&192|s))}return n},e}();r.Base64=o;var a=function(){function t(){}return t.GetInt64=function(t){var n=new e.Bond.Int64("0"),r=this._Read(t);return n.low=r[0],r.length>1&&(n.high=r[1]),n},t.GetNumber=function(e){return this._Read(e)[0]},t._Read=function(e){for(var t=[],n=0,r=!0,i=0;r;){if(r=0!=(128&(o=e.shift())),o&=127,!(i<28)){n|=o<<i,t.push(n),n=o>>4,i=3;break}n|=o<<i,i+=7}for(;r;){var o=e.shift();if(r=0!=(128&o),o&=127,n|=o<<i,(i+=7)>=32)break}return t.push(n),t},t}();r.Varint=a;var s=function(){function e(){}return e.GetNumber=function(e){if(t.BrowserChecker.IsDataViewSupport()){for(var r=new DataView(new ArrayBuffer(4)),i=0;i<4;++i)r.setUint8(i,e[i]);return r.getFloat32(0,!0)}return n.ConvertArrayToNumber(e,!1)},e}();r.Float=s;var u=function(){function e(){}return e.GetNumber=function(e){if(t.BrowserChecker.IsDataViewSupport()){for(var r=new DataView(new ArrayBuffer(8)),i=0;i<8;++i)r.setUint8(i,e[i]);return r.getFloat64(0,!0)}return n.ConvertArrayToNumber(e,!0)},e}();r.Double=u;var l=function(){function t(){}return t.DecodeZigzag16=function(e){return((65535&e)>>>1^-(1&e))<<16>>16},t.DecodeZigzag32=function(e){return e>>>1^-(1&e)},t.DecodeZigzag64=function(t){var n=1&t.high,r=t.high>>>1,i=1&t.low,o=t.low>>>1;o|=n<<31,i&&(o^=4294967295,r^=4294967295);var a=new e.Bond.UInt64("0");return a.low=o,a.high=r,a},t}();r.Zigzag=l}(t.Decoding||(t.Decoding={}));var n=function(){function e(){}return e.ConvertNumberToArray=function(e,t){if(!e)return t?this._doubleZero:this._floatZero;var n=t?11:8,r=t?52:23,i=(1<<n-1)-1,o=1-i,a=i,s=e<0?1:0;e=Math.abs(e);for(var u=Math.floor(e),l=e-u,d=2*(i+2)+r,c=new Array(d),p=0;p<d;)c[p++]=0;for(p=i+2;p&&u;)c[--p]=u%2,u=Math.floor(u/2);for(p=i+1;p<d-1&&l>0;)(l*=2)>=1?(c[++p]=1,--l):c[++p]=0;for(var f=0;f<d&&!c[f];++f);var g=i+1-f,h=f+r;if(c[h+1]){for(p=h;p>f&&!(c[p]=1-c[p]);--p);p==f&&++g}if(g>a||u)return s?t?this._doubleNegInifinity:this._floatNegInifinity:t?this._doubleInifinity:this._floatInifinity;if(g<o)return t?this._doubleZero:this._floatZero;if(t){var v=0;for(p=0;p<20;++p)v=v<<1|c[++f];for(var m=0;p<52;++p)m=m<<1|c[++f];return y=[255&m,m>>8&255,m>>16&255,m>>>24,255&(v=s<<31|2147483647&(v|=g+i<<20)),v>>8&255,v>>16&255,v>>>24]}var _=0;for(p=0;p<23;++p)_=_<<1|c[++f];var y=[255&(_=s<<31|2147483647&(_|=g+i<<23)),_>>8&255,_>>16&255,_>>>24];return y},e.ConvertArrayToNumber=function(e,n){var r=(1<<(n?11:8)-1)-1,i=0!=(128&e[n?7:3]),o=n?(127&e[7])<<4|(240&e[6])>>4:(127&e[3])<<1|(128&e[2])>>7;if(255==o)throw new t.Exception("Not a valid float/double buffer.");var a=1,s=1;if(n){var u=(15&e[6])<<28|(255&e[5])<<20|(255&e[4])<<12,l=e[3]<<24|(255&e[2])<<16|(255&e[1])<<8|255&e[0];if(!o&&!u&&!l)return 0;for(c=0;c<20;++c)s/=2,u<0&&(a+=s),u<<=1;for(c=0;c<32;++c)s/=2,l<0&&(a+=s),l<<=1}else{var d=(127&e[2])<<25|(255&e[1])<<17|(255&e[0])<<9;if(!o&&!d)return 0;for(var c=0;c<23;++c)s/=2,d<0&&(a+=s),d<<=1}return a*=Math.pow(2,o-r),i?0-a:a},e._floatZero=[0,0,0,0],e._doubleZero=[0,0,0,0,0,0,0,0],e._floatInifinity=[0,0,128,127],e._floatNegInifinity=[0,0,128,255],e._doubleInifinity=[0,0,0,0,0,0,240,127],e._doubleNegInifinity=[0,0,0,0,0,0,240,255],e}()}(e.Bond||(e.Bond={}))}(S||(S={}));!function(e){!function(e){!function(t){var n=function(){function t(){this._buffer=[]}return t.prototype.WriteByte=function(t){this._buffer.push(e.Number.ToByte(t))},t.prototype.Write=function(e,t,n){for(;n--;)this.WriteByte(e[t++])},t.prototype.GetBuffer=function(){return this._buffer},t}();t.MemoryStream=n}(e.IO||(e.IO={}))}(e.Bond||(e.Bond={}))}(S||(S={}));!function(e){!function(e){var t=function(){return function(e,t){this.Type=e,this.Id=t}}();e.FieldTag=t;var n=function(){return function(e,t){this.ElementType=e,this.Size=t}}();e.ContainerTag=n;var r=function(){return function(e,t,n){this.KeyType=e,this.ValueType=t,this.Size=n}}();e.KeyValueContainerTag=r;var i=function(){return function(){}}();e.Bonded=i;var o=function(){function e(e){this.low=0,this.high=0,this.low=parseInt(e),this.low<0&&(this.high=-1)}return e.prototype.Equals=function(t){var n=new e(t);return this.low==n.low&&this.high==n.high},e}();e.Int64=o;var a=function(){function e(e){this.low=0,this.high=0,this.low=parseInt(e)}return e.prototype.Equals=function(t){var n=new e(t);return this.low==n.low&&this.high==n.high},e}();e.UInt64=a;var s=function(){function e(){}return e.ToByte=function(e){return this.ToUInt8(e)},e.ToInt8=function(e){return 127&e|(128&e)<<24>>24},e.ToInt16=function(e){return 32767&e|(32768&e)<<16>>16},e.ToInt32=function(e){return 2147483647&e|2147483648&e},e.ToUInt8=function(e){return 255&e},e.ToUInt16=function(e){return 65535&e},e.ToUInt32=function(e){return 4294967295&e},e}();e.Number=s;var u=function(){return function(e){this.Message=e}}();e.Exception=u;var l=function(){return function(){}}();e.KeyValuePair=l;var d=function(){function e(){}return e.IsDataViewSupport=function(){return"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},e}();e.BrowserChecker=d}(e.Bond||(e.Bond={}))}(S||(S={}));var S;!function(e){!function(e){var t=function(){function t(e){this._stream=e}return t.prototype.WriteBlob=function(e){this._stream.Write(e,0,e.length)},t.prototype.WriteBool=function(e){this._stream.WriteByte(e?1:0)},t.prototype.WriteContainerBegin=function(e,t){this.WriteUInt8(t),this.WriteUInt32(e)},t.prototype.WriteMapContainerBegin=function(e,t,n){this.WriteUInt8(t),this.WriteUInt8(n),this.WriteUInt32(e)},t.prototype.WriteContainerEnd=function(){},t.prototype.WriteDouble=function(t){var n=e.Encoding.Double.GetBytes(t);this._stream.Write(n,0,n.length)},t.prototype.WriteFloat=function(t){var n=e.Encoding.Float.GetBytes(t);this._stream.Write(n,0,n.length)},t.prototype.WriteFieldBegin=function(e,t,n){t<=5?this._stream.WriteByte(e|t<<5):t<=255?(this._stream.WriteByte(192|e),this._stream.WriteByte(t)):(this._stream.WriteByte(224|e),this._stream.WriteByte(t),this._stream.WriteByte(t>>8))},t.prototype.WriteFieldEnd=function(){},t.prototype.WriteFieldOmitted=function(e,t,n){},t.prototype.WriteInt16=function(t){t=e.Encoding.Zigzag.EncodeZigzag16(t),this.WriteUInt16(t)},t.prototype.WriteInt32=function(t){t=e.Encoding.Zigzag.EncodeZigzag32(t),this.WriteUInt32(t)},t.prototype.WriteInt64=function(t){this.WriteUInt64(e.Encoding.Zigzag.EncodeZigzag64(t))},t.prototype.WriteInt8=function(t){this._stream.WriteByte(e.Number.ToInt8(t))},t.prototype.WriteString=function(t){if(""==t)this.WriteUInt32(0);else{var n=e.Encoding.Utf8.GetBytes(t);this.WriteUInt32(n.length),this._stream.Write(n,0,n.length)}},t.prototype.WriteStructBegin=function(e,t){},t.prototype.WriteStructEnd=function(t){this.WriteUInt8(t?e.BondDataType.BT_STOP_BASE:e.BondDataType.BT_STOP)},t.prototype.WriteUInt16=function(t){var n=e.Encoding.Varint.GetBytes(e.Number.ToUInt16(t));this._stream.Write(n,0,n.length)},t.prototype.WriteUInt32=function(t){var n=e.Encoding.Varint.GetBytes(e.Number.ToUInt32(t));this._stream.Write(n,0,n.length)},t.prototype.WriteUInt64=function(t){var n=e.Encoding.Varint64.GetBytes(t);this._stream.Write(n,0,n.length)},t.prototype.WriteUInt8=function(t){this._stream.WriteByte(e.Number.ToUInt8(t))},t.prototype.WriteWString=function(e){this.WriteUInt32(e.length);for(var t=0;t<e.length;++t){var n=e.charCodeAt(t);this._stream.WriteByte(n),this._stream.WriteByte(n>>>8)}},t}();e.CompactBinaryProtocolWriter=t;var n=function(){return function(){}}();e.CompactBinaryProtocolReader=n}(e.Bond||(e.Bond={}))}(S||(S={}));var E;!function(e){var t=function(){function t(){}return t.IsSafari=function(){if(null===t._isSafari)if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.toLowerCase();t._isSafari=e.indexOf("safari")>=0&&e.indexOf("chrome")<0}else t._isSafari=!1;return t._isSafari},t.IsReactNative=function(){return null===t._isReactNative&&(t._isReactNative=!("undefined"==typeof navigator||!navigator.product)&&"ReactNative"===navigator.product),t._isReactNative},t.IsUint8ArrSupported=function(){return!e.Utils.IsSafari()&&"undefined"!=typeof Uint8Array&&!e.Utils.IsReactNative()},t.ajax=function(e,n){var r=t._createConnection();if(e.headers){var i="qsp=true";for(var o in e.headers)i+="&",i+=encodeURIComponent(o),i+="=",i+=encodeURIComponent(e.headers[o]);e.url.indexOf("?")<0?e.url+="?":e.url+="&",e.url+=i}r.open(e.type,e.url,!n),e.complete&&(r.onload=function(){void 0===r.status&&(r.status=200),e.complete(r)},r.ontimeout=function(){void 0===r.status&&(r.status=500),e.complete(r)},r.onerror=function(){e.complete(r)}),r.send(e.data)},t.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},t.IsUsingXDomainRequest=function(){if(null==t._usingXDomainRequest){var e=new XMLHttpRequest;t._usingXDomainRequest=void 0===e.withCredentials&&"undefined"!=typeof XDomainRequest}return t._usingXDomainRequest},t._createConnection=function(){var e=new XMLHttpRequest;return t.IsUsingXDomainRequest()?new XDomainRequest:e},t._isSafari=null,t._isReactNative=null,t._usingXDomainRequest=null,t}();e.Utils=t}(E||(E={}));!function(e){!function(e){!function(e){!function(t){var n=function(){function e(){}return e.GetGuid=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1,5)};return[e(),e(),"-",e(),"-",e(),"-",e(),"-",e(),e(),e()].join("")},e.GetTimeStamp=function(){var e=(new Date).getTime(),t=new S.Bond.Int64("0");return t.low=4294967295&e,t.high=Math.floor(e/4294967296),t},e.GetTimeStampWithValue=function(e){var t=new S.Bond.Int64("0");return t.low=4294967295&e,t.high=Math.floor(e/4294967296),t},e}();t.utils=n,function(e){e[e.NotSet=0]="NotSet",e[e.Event=1]="Event",e[e.PerformanceCounter=2]="PerformanceCounter",e[e.Anomaly=3]="Anomaly",e[e.Prediction=4]="Prediction",e[e.TraceLog=5]="TraceLog",e[e.EventSourceLog=6]="EventSourceLog",e[e.HttpLog=7]="HttpLog",e[e.PerformanceCounterAzure=8]="PerformanceCounterAzure",e[e.PerformanceCounterGfs=9]="PerformanceCounterGfs"}(t.RecordType||(t.RecordType={})),t.RecordType,function(e){e[e.NotSet=0]="NotSet",e[e.O365=1]="O365",e[e.SkypeBI=2]="SkypeBI",e[e.SkypeData=3]="SkypeData"}(t.PIIScrubber||(t.PIIScrubber={})),t.PIIScrubber,function(e){e[e.NotSet=0]="NotSet",e[e.DistinguishedName=1]="DistinguishedName",e[e.GenericData=2]="GenericData",e[e.IPV4Address=3]="IPV4Address",e[e.IPv6Address=4]="IPv6Address",e[e.MailSubject=5]="MailSubject",e[e.PhoneNumber=6]="PhoneNumber",e[e.QueryString=7]="QueryString",e[e.SipAddress=8]="SipAddress",e[e.SmtpAddress=9]="SmtpAddress",e[e.Identity=10]="Identity",e[e.Uri=11]="Uri",e[e.Fqdn=12]="Fqdn",e[e.IPV4AddressLegacy=13]="IPV4AddressLegacy"}(t.PIIKind||(t.PIIKind={})),t.PIIKind,function(e){e[e.Unknown=0]="Unknown",e[e.MSACID=1]="MSACID",e[e.MSAPUID=2]="MSAPUID",e[e.ANID=3]="ANID",e[e.OrgIdCID=4]="OrgIdCID",e[e.OrgIdPUID=5]="OrgIdPUID",e[e.UserObjectId=6]="UserObjectId",e[e.Skype=7]="Skype",e[e.Yammer=8]="Yammer",e[e.EmailAddress=9]="EmailAddress",e[e.PhoneNumber=10]="PhoneNumber",e[e.SipAddress=11]="SipAddress",e[e.MUID=12]="MUID"}(t.UserIdType||(t.UserIdType={}));var r=(t.UserIdType,function(){function t(){this.ScrubType=e.datamodels.PIIScrubber.NotSet,this.Kind=e.datamodels.PIIKind.NotSet,this.RawContent=""}return t.prototype.Write=function(e){this.WriteImpl(e,!1)},t.prototype.WriteImpl=function(t,n){t.WriteStructBegin(null,n),this.ScrubType!=e.datamodels.PIIScrubber.NotSet?(t.WriteFieldBegin(S.Bond.BondDataType.BT_INT32,1,null),t.WriteInt32(this.ScrubType),t.WriteFieldEnd()):t.WriteFieldOmitted(S.Bond.BondDataType.BT_INT32,1,null),this.Kind!=e.datamodels.PIIKind.NotSet?(t.WriteFieldBegin(S.Bond.BondDataType.BT_INT32,2,null),t.WriteInt32(this.Kind),t.WriteFieldEnd()):t.WriteFieldOmitted(S.Bond.BondDataType.BT_INT32,2,null),""!=this.RawContent?(t.WriteFieldBegin(S.Bond.BondDataType.BT_STRING,3,null),t.WriteString(this.RawContent),t.WriteFieldEnd()):t.WriteFieldOmitted(S.Bond.BondDataType.BT_STRING,3,null),t.WriteStructEnd(n)},t.prototype.Read=function(e){this.ReadImpl(e,!1)},t.prototype.ReadImpl=function(e,t){},t}());t.PII=r;var i=function(){function t(){this.Id=n.GetGuid(),this.Timestamp=n.GetTimeStamp(),this.Type="",this.EventType="",this.Extension=new S.Bond.Collections.Map,this.RecordType=e.datamodels.RecordType.NotSet,this.PIIExtensions=new S.Bond.Collections.Map}return t.prototype.AddOrReplacePII=function(t,n,r){var i=new e.datamodels.PII;i.RawContent=n,i.Kind=r,i.ScrubType=e.datamodels.PIIScrubber.O365,this.PIIExtensions.AddOrReplace(t,i)},t.prototype.Write=function(e){this.WriteImpl(e,!1)},t.prototype.WriteImpl=function(t,n){if(t.WriteStructBegin(null,n),""!=this.Id?(t.WriteFieldBegin(S.Bond.BondDataType.BT_STRING,1,null),t.WriteString(this.Id),t.WriteFieldEnd()):t.WriteFieldOmitted(S.Bond.BondDataType.BT_STRING,1,null),this.Timestamp.Equals("0")?t.WriteFieldOmitted(S.Bond.BondDataType.BT_INT64,3,null):(t.WriteFieldBegin(S.Bond.BondDataType.BT_INT64,3,null),t.WriteInt64(this.Timestamp),t.WriteFieldEnd()),""!=this.Type?(t.WriteFieldBegin(S.Bond.BondDataType.BT_STRING,5,null),t.WriteString(this.Type),t.WriteFieldEnd()):t.WriteFieldOmitted(S.Bond.BondDataType.BT_STRING,5,null),""!=this.EventType?(t.WriteFieldBegin(S.Bond.BondDataType.BT_STRING,6,null),t.WriteString(this.EventType),t.WriteFieldEnd()):t.WriteFieldOmitted(S.Bond.BondDataType.BT_STRING,6,null),this.Extension.Count()){t.WriteFieldBegin(S.Bond.BondDataType.BT_MAP,13,null),t.WriteMapContainerBegin(this.Extension.Count(),S.Bond.BondDataType.BT_STRING,S.Bond.BondDataType.BT_STRING);for(var r=0;r<this.Extension.GetBuffer().length;++r)t.WriteString(this.Extension.GetBuffer()[r].Key),t.WriteString(this.Extension.GetBuffer()[r].Value);t.WriteContainerEnd(),t.WriteFieldEnd()}else t.WriteFieldOmitted(S.Bond.BondDataType.BT_MAP,13,null);if(this.RecordType!=e.datamodels.RecordType.NotSet?(t.WriteFieldBegin(S.Bond.BondDataType.BT_INT32,24,null),t.WriteInt32(this.RecordType),t.WriteFieldEnd()):t.WriteFieldOmitted(S.Bond.BondDataType.BT_INT32,24,null),this.PIIExtensions.Count()){t.WriteFieldBegin(S.Bond.BondDataType.BT_MAP,30,null),t.WriteMapContainerBegin(this.PIIExtensions.Count(),S.Bond.BondDataType.BT_STRING,S.Bond.BondDataType.BT_STRUCT);for(var i=0;i<this.PIIExtensions.GetBuffer().length;++i)t.WriteString(this.PIIExtensions.GetBuffer()[i].Key),this.PIIExtensions.GetBuffer()[i].Value.WriteImpl(t,!1);t.WriteContainerEnd(),t.WriteFieldEnd()}else t.WriteFieldOmitted(S.Bond.BondDataType.BT_MAP,30,null);t.WriteStructEnd(n)},t.prototype.Read=function(e){this.ReadImpl(e,!1)},t.prototype.ReadImpl=function(e,t){},t}();t.Record=i;var o=function(){function e(){this.Source="",this.DataPackageId="",this.Timestamp=new S.Bond.Int64("0"),this.Records=[]}return e.prototype.Write=function(e){this.WriteImpl(e,!1)},e.prototype.WriteImpl=function(e,t){if(e.WriteStructBegin(null,t),""!=this.Source?(e.WriteFieldBegin(S.Bond.BondDataType.BT_STRING,2,null),e.WriteString(this.Source),e.WriteFieldEnd()):e.WriteFieldOmitted(S.Bond.BondDataType.BT_STRING,2,null),""!=this.DataPackageId?(e.WriteFieldBegin(S.Bond.BondDataType.BT_STRING,5,null),e.WriteString(this.DataPackageId),e.WriteFieldEnd()):e.WriteFieldOmitted(S.Bond.BondDataType.BT_STRING,5,null),this.Timestamp.Equals("0")?e.WriteFieldOmitted(S.Bond.BondDataType.BT_INT64,6,null):(e.WriteFieldBegin(S.Bond.BondDataType.BT_INT64,6,null),e.WriteInt64(this.Timestamp),e.WriteFieldEnd()),this.Records.length){e.WriteFieldBegin(S.Bond.BondDataType.BT_LIST,8,null),e.WriteContainerBegin(this.Records.length,S.Bond.BondDataType.BT_STRUCT);for(var n=0;n<this.Records.length;++n)this.Records[n].WriteImpl(e,!1);e.WriteContainerEnd(),e.WriteFieldEnd()}else e.WriteFieldOmitted(S.Bond.BondDataType.BT_LIST,8,null);e.WriteStructEnd(t)},e.prototype.Read=function(e){this.ReadImpl(e,!1)},e.prototype.ReadImpl=function(e,t){},e}();t.DataPackage=o;var a=function(){function e(){this.DataPackages=[],this.RequestRetryCount=0}return e.prototype.Write=function(e){this.WriteImpl(e,!1)},e.prototype.WriteImpl=function(e,t){if(e.WriteStructBegin(null,t),this.DataPackages.length){e.WriteFieldBegin(S.Bond.BondDataType.BT_LIST,1,null),e.WriteContainerBegin(this.DataPackages.length,S.Bond.BondDataType.BT_STRUCT);for(var n=0;n<this.DataPackages.length;++n)this.DataPackages[n].WriteImpl(e,!1);e.WriteContainerEnd(),e.WriteFieldEnd()}else e.WriteFieldOmitted(S.Bond.BondDataType.BT_LIST,1,null);0!=this.RequestRetryCount?(e.WriteFieldBegin(S.Bond.BondDataType.BT_INT32,2,null),e.WriteInt32(this.RequestRetryCount),e.WriteFieldEnd()):e.WriteFieldOmitted(S.Bond.BondDataType.BT_INT32,2,null),e.WriteStructEnd(t)},e.prototype.Read=function(e){this.ReadImpl(e,!1)},e.prototype.ReadImpl=function(e,t){},e}();t.ClientToCollectorRequest=a}(e.datamodels||(e.datamodels={}))}(e.telemetry||(e.telemetry={}))}(e.applications||(e.applications={}))}(A||(A={}));!function(e){!function(e){!function(e){!function(t){!function(e){e[e.SENT=0]="SENT",e[e.SEND_FAILED=1]="SEND_FAILED"}(t.CallbackEventType||(t.CallbackEventType={}));var n=t.CallbackEventType;!function(e){e[e.DATARV_ERROR_OK=0]="DATARV_ERROR_OK",e[e.DATARV_ERROR_INVALID_EVENT=1]="DATARV_ERROR_INVALID_EVENT",e[e.DATARV_ERROR_INVALID_CONFIG=2]="DATARV_ERROR_INVALID_CONFIG",e[e.DATARV_ERROR_INVALID_DEPENDENCIES=3]="DATARV_ERROR_INVALID_DEPENDENCIES",e[e.DATARV_ERROR_INVALID_STATUS=4]="DATARV_ERROR_INVALID_STATUS",e[e.DATARV_ERROR_INVALID_ARG=5]="DATARV_ERROR_INVALID_ARG"}(t.DATARV_ERROR||(t.DATARV_ERROR={}));var r=t.DATARV_ERROR,i=function(){function e(e){this._errorCode=r.DATARV_ERROR_OK,this._errorCode=e}return e.prototype.ErrorCode=function(){return this._errorCode},e.prototype.toString=function(){switch(this._errorCode){case r.DATARV_ERROR_OK:return"DATARV_ERROR_OK";case r.DATARV_ERROR_INVALID_EVENT:return"Event is invalid. Either event.Id is empty, or event.Timestamp is empty, or event.EventType is empty.";case r.DATARV_ERROR_INVALID_CONFIG:return"Invalid configuration. CollectorUrl is missing.";case r.DATARV_ERROR_INVALID_DEPENDENCIES:return"DATARV_ERROR_INVALID_DEPENDENCIES";case r.DATARV_ERROR_INVALID_STATUS:return"Telemetry Manager is not initialized.";case r.DATARV_ERROR_INVALID_ARG:return"TenantToken is null or empty, or events is null.";default:return"Unknown error"}},e}();t.Exception=i;var o=function(){return function(){}}();t.TelemetryConfig=o;var a=function(){function e(){}return e.CreateTelemetryManager=function(){return new l},e}();t.TelemetryManagerFactory=a;var s,u=function(){function e(){}return e.MaxPackageSizeInBytes=function(){return 3e6},e.TimeIntervalForNextSendInMS=function(){return 1e3},e}();!function(e){e[e.Created=0]="Created",e[e.Initialized=1]="Initialized",e[e.Started=2]="Started"}(s||(s={}));var l=function(){function t(){this._MaxPackageSizeInBytes=u.MaxPackageSizeInBytes(),this._listeners=[],this._status=s.Created,this._etag=null,this._testServerResponseHook=null,this._isPaused=!1}return t.prototype.Initialize=function(e){if(this._status!=s.Created)throw new i(r.DATARV_ERROR_INVALID_STATUS);if(!e||!e.collectorUrl)throw new i(r.DATARV_ERROR_INVALID_CONFIG);this._config=e,this._Reset(),this._status=s.Initialized,this._Verbose("Initialize() done")},t.prototype.AddListener=function(e){if(this._status<s.Initialized)throw new i(r.DATARV_ERROR_INVALID_STATUS);this._Verbose(["AddListener(), status: ",this._status," old length: ",this._listeners.length," func: ",e].join(""));for(var t=0;t<this._listeners.length;++t)if(this._listeners[t]==e)return void this._Verbose("the listener has been added already, index: "+t);this._listeners.push(e),this._Verbose("AddListener() done, the new length: "+this._listeners.length)},t.prototype.RemoveListener=function(e){if(this._status<s.Initialized)throw new i(r.DATARV_ERROR_INVALID_STATUS);this._Verbose(["RemoveListener(), status: ",this._status," old length: ",this._listeners.length," func: ",e].join(""));for(var t=0;t<this._listeners.length;++t)if(this._listeners[t]==e)return 1==this._listeners.length?this._listeners=[]:t==this._listeners.length-1?this._listeners.pop():this._listeners[t]=this._listeners.pop(),void this._Verbose(["this listener has been found, index: ",t,"new length: ",this._listeners.length].join(""));this._Verbose("listener isn't been found, new length"+this._listeners.length)},t.prototype.Start=function(){if(this._status<s.Initialized)throw new i(r.DATARV_ERROR_INVALID_STATUS);this._Verbose(["Start(), status:",this._status,"tag:",t._tag].join(" ")),this._status>=s.Started&&this._Verbose("Start() already, ignore"),++t._tag,this._status=s.Started,this._Verbose(["Start() done, status: ",this._status,"tag: ",t._tag].join(""))},t.prototype.Stop=function(){if(this._status<s.Initialized)throw new i(r.DATARV_ERROR_INVALID_STATUS);return this._Verbose("Stop(), status: "+this._status),this._status==s.Initialized?void this._Verbose("Stop() already, ignore"):(this._Reset(),this._status=s.Initialized,void this._Verbose("Stop() done, status: "+this._status))},t.prototype.Pause=function(){this._isPaused=!0,this._CleanTimer()},t.prototype.Resume=function(){this._isPaused=!1,this._eventsCache.IsEmpty()||this._timer||this._ScheduleTimer(!1)},t.prototype.Flush=function(e){this._eventsCache.IsEmpty()||this._WorkThread(e,!0)},t.prototype.SendAsync=function(e,n){if(this._status<s.Initialized)throw new i(r.DATARV_ERROR_INVALID_STATUS);if(this._Verbose(["SendAsync(), status:",this._status,"tenantToken:",e,"count:",n.length].join(" ")),this._status<s.Started)return this._Info("SendAsync(), not started, ignore, return false"),!1;if(!e||!n)throw this._Error("SendAsync(), tenantToken or events is null or empty"),new i(r.DATARV_ERROR_INVALID_ARG);for(var o=0;o<n.length;++o)if(!n[o].Id||!t._eventTypeRegex.test(n[o].EventType)||n[o].Timestamp.Equals("0"))throw this._Error(["eventId:",n[o].Id,"eventType:",n[o].EventType,"timestamp high:",n[o].Timestamp.high,"timestamp low:",n[o].Timestamp.low].join("")),new i(r.DATARV_ERROR_INVALID_EVENT);return this._eventsCache.AddEvents(e,n),this._Verbose(["SendAsync(), currentTimer: ",this._timer,"eventsCacheIsEmpty",this._eventsCache.IsEmpty()].join(" ")),this._eventsCache.IsEmpty()||this._timer||this._ScheduleTimer(!1),this._Verbose("SendAsync() done"),!0},t.prototype._WorkThread=function(e,n){var r=this;try{if(this._Verbose("_WorkThread, status: "+this._status),this._status<s.Started)return void this._Verbose("_WorkThread, status is not started, return");var i=this._eventsCache.DequeuEvents();if(null==i)return this._Verbose("_WorkThread, No events found, return"),void this._CleanTimer();var o=this._PackEvents(i.tenantToken,i.events);if(this._eventsCache.AddEvents(i.tenantToken,o.remainedEvents),null==o.buffer||0==o.buffer.length)return void(this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1)));if(this._testServerResponseHook){var a=this._testServerResponseHook();return void setTimeout(this._SendCallback(l,i.tenantToken,o.sendEvents,a,!1,null),100)}var u={type:"POST",url:this._config.collectorUrl,processData:!1,headers:{"content-type":"application/bond-compact-binary","client-id":"NO_AUTH","sdk-version":"ACT-Web-JS-"+T.version},complete:function(t){return r._SendCallback(l,i.tenantToken,o.sendEvents,t,n,e)}};E.Utils.IsUint8ArrSupported()?(this._Verbose("Uint8Array is defined, send with binary format directly."),u.data=new Uint8Array(o.buffer)):(this._Verbose("Uint8Array is undefined, send with base64 encode."),u.data=S.Bond.Encoding.Base64.GetString(o.buffer),u.headers["content-encoding"]="base64"),i.tenantToken&&(u.headers["x-apikey"]=i.tenantToken);var l=t._tag;this._lastActiveTime=(new Date).getTime(),E.Utils.ajax(u,n),this._Verbose("_Workthread, send via jquery, tag: "+l)}catch(e){this._Error("_WorkThread, exception: "+e)}},t.prototype._PackEvents=function(t,n){this._Verbose("_PackageEvents, total Count: "+n.length);var r=new e.datamodels.ClientToCollectorRequest,i=new e.datamodels.DataPackage;i.Source="JS_default_source",i.DataPackageId=e.datamodels.utils.GetGuid(),i.Timestamp=e.datamodels.utils.GetTimeStamp();var o,a=n;for(n=[];i.Records=[],i.Records.push.apply(i.Records,a),r.DataPackages=[],r.DataPackages.push(i),o=this._Serialize(r),this._Verbose(["_PackageEvents, sendEvents.length:",a.length,"buffer.length:",o.length,"MaxPackageSize:",this._MaxPackageSizeInBytes].join("")),!(o.length<this._MaxPackageSizeInBytes);){if(1==a.length){a=[],o=null;break}var s=a.splice(0,Math.floor(a.length/2));this._Verbose("_PackageEvents, too large, package again"),n.push.apply(n,a),a=s}return this._Verbose(["_PakcageEvents done, sendEventsCount:",a.length,"buffer.length:",null==o?0:o.length,"remained events:",n.length].join("")),{buffer:o,sendEvents:a,remainedEvents:n}},t.prototype._Serialize=function(e){var t=new S.Bond.IO.MemoryStream,n=new S.Bond.CompactBinaryProtocolWriter(t);return e.Write(n),t.GetBuffer()},t.prototype._SendCallback=function(e,r,i,o,a,u){if(this._Verbose(["_SendCallback","tag:",e,"current tag:",t._tag,"tenantToken:",r,"events count:",i.length,"jqXHR:",o].join("")),u&&u(o?o.status:0,r,i),!a){var l=null!=o&&o.status>=200&&o.status<300;if(this._status<s.Started||e<t._tag)return void this._Verbose("_SendCallback, is not started, or tag is not the same, return");if(!l&&(!o||o.status&&400!=o.status))return this._Verbose("retry statusCode: "+(o?o.status:0)),this._eventsCache.AddEvents(r,i),void this._ScheduleTimer(!0);for(var d=0;d<this._listeners.length;++d)this._listeners[d](l?n.SENT:n.SEND_FAILED,o?o.status:0,r,i);this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1))}},t.prototype._CleanTimer=function(){this._Verbose("_CleanTimer(), timer: "+this._timer),this._timer&&(clearTimeout(this._timer),this._timer=null)},t.prototype._ScheduleTimer=function(e){var t=this;if(!this._isPaused)if(this._Verbose("_ScheduleTimer: isRetry: "+e),this._CleanTimer(),e){this._Verbose("_ScheduleTimer, current factor: "+this._rescheduleFactor);n=Math.floor(5*this._rescheduleFactor*(1+Math.random()));this._timer=setTimeout(function(){return t._WorkThread(null,!1)},1e3*n),this._Verbose("_ScheduleTimer, next try (s): "+n),this._rescheduleFactor<<=1,this._rescheduleFactor>64&&(this._rescheduleFactor=1)}else{var n=0,r=(new Date).getTime()-this._lastActiveTime;n=r>u.TimeIntervalForNextSendInMS()?0:u.TimeIntervalForNextSendInMS()-r,this._timer=setTimeout(function(){return t._WorkThread(null,!1)},n),this._Verbose("_ScheduleTimer, next try: "+n),this._rescheduleFactor=1}},t.prototype._Verbose=function(e){this._config.log&&this._config.log.Verbose("[TelemetryManagerImpl]: "+e)},t.prototype._Info=function(e){this._config.log&&this._config.log.Info("[TelemetryManagerImpl]: "+e)},t.prototype._Error=function(e){this._config.log&&this._config.log.Error("[TelemetryManagerImpl]: "+e)},t.prototype._Reset=function(){this._Verbose("Reset()"),this._CleanTimer(),this._lastActiveTime=0,this._rescheduleFactor=1,this._sendingEvents=[],this._eventsCache=new d},t.prototype.__GetListenerArray=function(){return this._listeners},t.prototype.__GetTotalEventsCount=function(){return this._eventsCache.GetTotalEventsCount()},t.prototype.__IsScheduled=function(){return null!=this._timer},t.prototype.__ChageMaxPackageSizeInKB=function(e){this._MaxPackageSizeInBytes=1024*e},t.prototype.__SetTestServerResponseHook=function(e){this._testServerResponseHook=e},t._eventTypeRegex=/^[a-zA-Z0-9]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/,t._tag=0,t}(),d=function(){function e(){this._events={},this._tokens=[]}return e.prototype.AddEvents=function(e,t){t.length&&(this._events[e]||(this._events[e]=[],this._tokens.push(e)),this._events[e].push.apply(this._events[e],t))},e.prototype.IsEmpty=function(){return 0==this._tokens.length},e.prototype.DequeuEvents=function(){if(0==this._tokens.length)return null;var e=this._tokens.shift(),t=this._events[e];return delete this._events[e],{tenantToken:e,events:t}},e.prototype.GetTotalEventsCount=function(){var e=0;for(var t in this._events)e+=this._events[t].length;return e},e}()}(e._sender||(e._sender={}))}(e.telemetry||(e.telemetry={}))}(e.applications||(e.applications={}))}(A||(A={}));var A;!function(n){!function(r){!function(r){var i=r._sender.TelemetryManagerFactory.CreateTelemetryManager(),o=function(){return function(){this.collectorUrl=null,this.enableAutoUserSession=!1,this.browserOverrides=new a}}();r.LogConfiguration=o;var a=function(){return function(){this.onSaveData=null,this.onGetData=null}}();r.LogConfigurationBrowserOverrides=a;var s=function(){function e(){this.value=null,this.pii=null}return e._isPii=function(e){return null!==e&&void 0!==e&&e!==r.datamodels.PIIKind.NotSet&&!isNaN(e)&&void 0!==r.datamodels.PIIKind[e]},e}(),u=function(){function e(){this.name=null,this.timestamp=null,this.properties={},this.eventType=null}return e.prototype.setProperty=function(t,n,i){if(!t||!e._propertyNameRegex.test(t))throw new d(l.INVALID_PROPERTY_NAME);this.properties[t]=i?{value:n,pii:i!=r.datamodels.PIIKind.NotSet?i:null}:{value:n,pii:null}},e._propertyNameRegex=/^[a-zA-Z0-9](([a-zA-Z0-9|_|\.]){0,98}[a-zA-Z0-9])?$/,e}();r.EventProperties=u,function(e){e[e.INVALID_TENANT_TOKEN=1]="INVALID_TENANT_TOKEN",e[e.MISSING_EVENT_PROPERTIES_NAME=2]="MISSING_EVENT_PROPERTIES_NAME",e[e.INVALID_PROPERTY_NAME=3]="INVALID_PROPERTY_NAME",e[e.MISSING_FAILURE_SIGNATURE=5]="MISSING_FAILURE_SIGNATURE",e[e.MISSING_FAILURE_DETAIL=6]="MISSING_FAILURE_DETAIL",e[e.MISSING_PAGEVIEW_ID=7]="MISSING_PAGEVIEW_ID",e[e.MISSING_PAGEVIEW_NAME=8]="MISSING_PAGEVIEW_NAME",e[e.INVALID_SESSION_STATE=9]="INVALID_SESSION_STATE",e[e.INVALID_CONFIGURATION_USE_CUSTOM_GET_SET=10]="INVALID_CONFIGURATION_USE_CUSTOM_GET_SET"}(r.TelemetryError||(r.TelemetryError={}));var l=r.TelemetryError,d=function(){function e(e){this.errorCode=null,this.errorCode=e}return e.prototype.ErrorCode=function(){return this.errorCode},e.prototype.toString=function(){switch(this.errorCode){case l.INVALID_TENANT_TOKEN:return"Invalid tenant token";case l.MISSING_EVENT_PROPERTIES_NAME:return"Eventproperties.name can not be null or empty";case l.INVALID_PROPERTY_NAME:return"Invalid Key. Key does not conform to regular expression ^[a-zA-Z0-9](([a-zA-Z0-9|_|.]){0,98}[a-zA-Z0-9])?$";case l.MISSING_FAILURE_SIGNATURE:return"Failure signature can't be null or empty.";case l.MISSING_FAILURE_DETAIL:return"Failure detail can't be null or empty.";case l.MISSING_PAGEVIEW_ID:return"Pageview id can't be null or empty.";case l.MISSING_PAGEVIEW_NAME:return"Pageview name can't be null or empty.";case l.INVALID_SESSION_STATE:return"Session state has to be a value from the SessionState enum.";case l.INVALID_CONFIGURATION_USE_CUSTOM_GET_SET:return"Invalid configuration provided during initialization. Both onGetConfigData and onSaveConfigData must be provided together.  These are manditory when running in a non-brower enviornment";default:return"Unknown error"}},e}();r.Exception=d;var c=function(){function e(e){this.contextMap={},this.piiKind=r.datamodels.PIIKind.NotSet,this._allowDeviceInfoFields=!1,this._allowDeviceInfoFields=e}return e.prototype.setAppId=function(e){e&&(this.contextMap["AppInfo.Id"]=e)},e.prototype.setAppVersion=function(e){e&&(this.contextMap["AppInfo.Version"]=e)},e.prototype.setAppLanguage=function(e){e&&(this.contextMap["AppInfo.Language"]=e)},e.prototype.setDeviceId=function(e){e&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.Id"]=e,p.checkAndUpdateDeviceId(e))},e.prototype.setDeviceOsName=function(e){e&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.OsName"]=e)},e.prototype.setDeviceOsVersion=function(e){e&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.OsVersion"]=e)},e.prototype.setDeviceBrowserName=function(e){e&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.BrowserName"]=e)},e.prototype.setDeviceBrowserVersion=function(e){e&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.BrowserVersion"]=e)},e.prototype.setUserId=function(e,t,r){if(e&&(this.contextMap["UserInfo.Id"]=e),r)this.contextMap["UserInfo.IdType"]=r;else{var i;switch(t){case n.applications.telemetry.datamodels.PIIKind.SipAddress:i=n.applications.telemetry.datamodels.UserIdType.SipAddress;break;case n.applications.telemetry.datamodels.PIIKind.PhoneNumber:i=n.applications.telemetry.datamodels.UserIdType.PhoneNumber;break;case n.applications.telemetry.datamodels.PIIKind.SmtpAddress:i=n.applications.telemetry.datamodels.UserIdType.EmailAddress;break;default:i=n.applications.telemetry.datamodels.UserIdType.Unknown}this.contextMap["UserInfo.IdType"]=i}if(t)s._isPii(t)&&(this.piiKind=t);else{var o;switch(r){case n.applications.telemetry.datamodels.UserIdType.Skype:o=n.applications.telemetry.datamodels.PIIKind.Identity;break;case n.applications.telemetry.datamodels.UserIdType.EmailAddress:o=n.applications.telemetry.datamodels.PIIKind.SmtpAddress;break;case n.applications.telemetry.datamodels.UserIdType.PhoneNumber:o=n.applications.telemetry.datamodels.PIIKind.PhoneNumber;break;case n.applications.telemetry.datamodels.UserIdType.SipAddress:o=n.applications.telemetry.datamodels.PIIKind.SipAddress;break;default:o=n.applications.telemetry.datamodels.PIIKind.NotSet}s._isPii(o)&&(this.piiKind=o)}},e.prototype.setUserMsaId=function(e){e&&(this.contextMap["UserInfo.MsaId"]=e)},e.prototype.setUserANID=function(e){e&&(this.contextMap["UserInfo.ANID"]=e)},e.prototype.setUserAdvertisingId=function(e){e&&(this.contextMap["UserInfo.AdvertisingId"]=e)},e.prototype.setUserTimeZone=function(e){e&&(this.contextMap["UserInfo.TimeZone"]=e)},e.prototype.setUserLanguage=function(e){e&&(this.contextMap["UserInfo.Language"]=e)},e}();r.SemanticContext=c;var p=function(){function t(){}return t.initialize=function(e){this._overrides=e;var n=t._getAppLanguage();n&&t.semanticContext.setAppLanguage(n);var i=t._getUserLanguage();i&&t.semanticContext.setUserLanguage(i);var o=(new Date).getTimezoneOffset(),a=o%60,s=(o-a)/60,u="+";s>0&&(u="-"),s=Math.abs(s),a=Math.abs(a),t.semanticContext.setUserTimeZone(u+(s<10?"0"+s:s.toString())+":"+(a<10?"0"+a:a.toString())),t._getUserAgent()&&(t.semanticContext.setDeviceBrowserName(t._getBrowserName()),t.semanticContext.setDeviceBrowserVersion(t._getBrowserVersion()),t.semanticContext.setDeviceOsName(t._getOsName()),t.semanticContext.setDeviceOsVersion(t._getOsVersion()));var l=t._getData(t.DEVICE_ID_COOKIE);l&&""!=l||(l=r.datamodels.utils.GetGuid()),t.semanticContext.setDeviceId(l)},t.checkAndUpdateDeviceId=function(e){t._getData(t.DEVICE_ID_COOKIE)!=e&&(t._saveData(t.DEVICE_ID_COOKIE,e),t._saveData(t.FIRST_LAUNCH_TIME_COOKIE,(new Date).getTime().toString()));var n=t._getData(t.FIRST_LAUNCH_TIME_COOKIE);t.firstLaunchTime=parseInt(n)},t._saveData=function(t,n){if(this._overrides.onSaveData)this._overrides.onSaveData(t,n);else if(void 0!==e&&e.cookie){e.cookie=t+"="+n+"; expires=Mon, 31 Dec 2029 23:59:59 GMT"}},t._getData=function(t){if(this._overrides.onGetData)return this._overrides.onGetData(t)||"";if(void 0!==e&&e.cookie)for(var n=t+"=",r=e.cookie.split(";"),i=0;i<r.length;i++){for(var o=r[i],a=0;" "==o.charAt(a);)a++;if(0==(o=o.substring(a)).indexOf(n))return o.substring(n.length,o.length)}return""},t._getUserAgent=function(){return"undefined"!=typeof navigator?navigator.userAgent||"":""},t._getAppLanguage=function(){return void 0!==e&&e.documentElement?e.documentElement.lang:null},t._getUserLanguage=function(){return"undefined"!=typeof navigator?navigator.userLanguage||navigator.language:null},t._userAgentContainsString=function(e){return t._getUserAgent().indexOf(e)>-1},t._isIe=function(){return t._userAgentContainsString("Trident")},t._isEdge=function(){return t._userAgentContainsString(t.BROWSERS.EDGE)},t._isOpera=function(){return t._userAgentContainsString("OPR/")},t._getBrowserName=function(){return t._isOpera()?t.BROWSERS.UNKNOWN:t._userAgentContainsString(t.BROWSERS.PHANTOMJS)?t.BROWSERS.PHANTOMJS:t._isEdge()?t.BROWSERS.EDGE:t._userAgentContainsString(t.BROWSERS.ELECTRON)?t.BROWSERS.ELECTRON:t._userAgentContainsString(t.BROWSERS.CHROME)?t.BROWSERS.CHROME:t._userAgentContainsString(t.BROWSERS.FIREFOX)?t.BROWSERS.FIREFOX:t._userAgentContainsString(t.BROWSERS.SAFARI)?t.BROWSERS.SAFARI:t._userAgentContainsString(t.BROWSERS.SKYPE_SHELL)?t.BROWSERS.SKYPE_SHELL:t._isIe()?t.BROWSERS.MSIE:t.BROWSERS.UNKNOWN},t._getBrowserVersion=function(){return t._isIe()?function(){var e,n=t._getUserAgent(),r=n.match(new RegExp(t.BROWSERS.MSIE+" "+t.REGEX_VERSION));return r?r[1]:(e=n.match(new RegExp("rv:"+t.REGEX_VERSION)))?e[1]:void 0}():function(e){var n;return e===t.BROWSERS.SAFARI&&(e="Version"),(n=t._getUserAgent().match(new RegExp(e+"/"+t.REGEX_VERSION)))?n[1]:t.UNKNOWN_VERSION}(t._getBrowserName())},t._getOsName=function(){var e=/(windows|win32)/i,n=/ arm;/i,r=/windows\sphone\s\d+\.\d+/i,i=/(macintosh|mac os x)/i,o=/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i,a=/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,s=/android/i;return t._getUserAgent().match(r)?t.OPERATING_SYSTEMS.WINDOWS_PHONE:t._getUserAgent().match(n)?t.OPERATING_SYSTEMS.WINDOWS_RT:t._getUserAgent().match(o)?t.OPERATING_SYSTEMS.IOS:t._getUserAgent().match(s)?t.OPERATING_SYSTEMS.ANDROID:t._getUserAgent().match(a)?t.OPERATING_SYSTEMS.LINUX:t._getUserAgent().match(i)?t.OPERATING_SYSTEMS.MACOSX:t._getUserAgent().match(e)?t.OPERATING_SYSTEMS.WINDOWS:t.OPERATING_SYSTEMS.UNKNOWN},t._getOsVersion=function(){function e(e){return e.indexOf(".")>-1?".":e.indexOf("_")>-1?"_":null}return t._getOsName()===t.OPERATING_SYSTEMS.WINDOWS?function(){var e=t._getUserAgent().match(new RegExp("Windows NT "+t.REGEX_VERSION));return e&&t.VERSION_MAPPINGS[e[1]]?t.VERSION_MAPPINGS[e[1]]:t.UNKNOWN_VERSION}():t._getOsName()===t.OPERATING_SYSTEMS.MACOSX?function(){var n=t._getUserAgent().match(new RegExp(t.OPERATING_SYSTEMS.MACOSX+" "+t.REGEX_VERSION_MAC));if(n){var r=n[1].replace(/_/g,".");if(r){var i=e(r);return i?r.split(i)[0]:r}}return t.UNKNOWN_VERSION}():t.UNKNOWN_VERSION},t.semanticContext=new c(!0),t.firstLaunchTime=-1,t.BROWSERS={MSIE:"MSIE",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",EDGE:"Edge",ELECTRON:"Electron",SKYPE_SHELL:"SkypeShell",PHANTOMJS:"PhantomJS",UNKNOWN:"Unknown"},t.OPERATING_SYSTEMS={WINDOWS:"Windows",MACOSX:"Mac OS X",WINDOWS_PHONE:"Windows Phone",WINDOWS_RT:"Windows RT",IOS:"iOS",ANDROID:"Android",LINUX:"Linux",UNKNOWN:"Unknown"},t.VERSION_MAPPINGS={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},t.REGEX_VERSION="([\\d,.]+)",t.REGEX_VERSION_MAC="([\\d,_,.]+)",t.UNKNOWN_VERSION="Unknown",t.DEVICE_ID_COOKIE="MicrosoftApplicationsTelemetryDeviceId",t.FIRST_LAUNCH_TIME_COOKIE="MicrosoftApplicationsTelemetryFirstLaunchTime",t}();!function(e){e[e.STARTED=0]="STARTED",e[e.ENDED=1]="ENDED"}(r.SessionState||(r.SessionState={}));var f=r.SessionState,g=function(){function e(){}return e.initialize=function(n,r){if(!e._initialized){if(!n)throw new d(l.INVALID_TENANT_TOKEN);if(e._defaultToken=n,e._tmConfig.collectorUrl="https://browser.pipe.aria.microsoft.com/Collector/3.0/",e._configuration=r,!(void 0!==t||r&&r.browserOverrides&&r.browserOverrides.onGetData))throw new d(l.INVALID_CONFIGURATION_USE_CUSTOM_GET_SET);var o=new a;if(r&&(r.collectorUrl&&(e._tmConfig.collectorUrl=r.collectorUrl),r.browserOverrides)){if(r.browserOverrides.onGetData?!r.browserOverrides.onSaveData:!!r.browserOverrides.onSaveData)throw new d(l.INVALID_CONFIGURATION_USE_CUSTOM_GET_SET);o.onGetData=r.browserOverrides.onGetData,o.onSaveData=r.browserOverrides.onSaveData}i.Initialize(e._tmConfig),i.Start(),p.initialize(o),e._initialized=!0,void 0!==t&&t.addEventListener&&(r&&r.enableAutoUserSession&&(e._logger=new h).logSession(f.STARTED),t.addEventListener("beforeunload",e._teardown))}},e.pauseTransmission=function(){i.Pause()},e.resumeTransmission=function(){i.Resume()},e.flush=function(e){i.Flush(e)},e.addCallbackListener=function(t){e._initialized&&i.AddListener(t)},e.setContext=function(t,n,r){e._contextProperties.setProperty(t,n,r)},e.isInitialized=function(){return e._initialized},e.getDefaultToken=function(){return e._defaultToken},e.getSemanticContext=function(){return e._semanticContext},e._getInitIdForToken=function(t){return e._initIdMap[t]||(e._initIdMap[t]=r.datamodels.utils.GetGuid()),e._initIdMap[t]},e._getSequenceForToken=function(t){return e._sequenceMap[t]||(e._sequenceMap[t]=0),++e._sequenceMap[t]},e._teardown=function(){e._logger&&e._logger.logSession(f.ENDED),e.flush()},e.__backToUninitialized=function(){e._tmConfig=new r._sender.TelemetryConfig,e._semanticContext=new c(!0),e._contextProperties=new u,e._configuration=null,i=r._sender.TelemetryManagerFactory.CreateTelemetryManager(),e._initialized=!1,e._initIdMap={},e._sequenceMap={}},e._initialized=!1,e._defaultToken=null,e._tmConfig=new r._sender.TelemetryConfig,e._logger=null,e._initIdMap={},e._sequenceMap={},e._configuration=null,e._contextProperties=new u,e._semanticContext=new c(!0),e}();r.LogManager=g;var h=function(){function e(e){this._initId=null,this._tenantToken=null,this._contextProperties=new u,this._semanticContext=new c(!1),this._sessionStartTime=0,this._sessionId=null,this._tenantToken=e||g.getDefaultToken(),this._initId=g._getInitIdForToken(this._tenantToken)}return e.prototype.logEvent=function(e){if(!e.name)throw new d(l.MISSING_EVENT_PROPERTIES_NAME);var t=this._createEventRecord(e.name,e.eventType);this._addPropertiesAndSendEvent(t,e)},e.prototype.logFailure=function(e,t,n,r,i){if(!e)throw new d(l.MISSING_FAILURE_SIGNATURE);if(!t)throw new d(l.MISSING_FAILURE_DETAIL);var o=this._createEventRecord("failure","failure");o.Extension.Add("Failure.Signature",e),o.Extension.Add("Failure.Detail",t),n&&o.Extension.Add("Failure.Category",n),r&&o.Extension.Add("Failure.Id",r),this._addPropertiesAndSendEvent(o,i)},e.prototype.logPageView=function(e,t,n,r,i,o){if(!e)throw new d(l.MISSING_PAGEVIEW_ID);if(!t)throw new d(l.MISSING_PAGEVIEW_NAME);var a=this._createEventRecord("pageview","pageview");a.Extension.Add("PageView.Id",e),a.Extension.Add("PageView.Name",t),n&&a.Extension.Add("PageView.Category",n),r&&a.Extension.Add("PageView.Uri",r),i&&a.Extension.Add("PageView.ReferrerUri",i),this._addPropertiesAndSendEvent(a,o)},e.prototype.logSession=function(e,t){if(e!==f.STARTED&&e!==f.ENDED)throw new d(l.INVALID_SESSION_STATE);var n=this._createEventRecord("session","session");if(e===f.STARTED){if(this._sessionStartTime>0)return;this._sessionStartTime=(new Date).getTime(),this._sessionId=r.datamodels.utils.GetGuid(),n.Extension.Add("Session.Id",this._sessionId),n.Extension.Add("Session.State","Started")}else if(e===f.ENDED){if(0==this._sessionStartTime)return;var i=Math.floor(((new Date).getTime()-this._sessionStartTime)/1e3);n.Extension.Add("Session.Duration",i.toString()),n.Extension.Add("Session.DurationBucket",this._getSessionDurationFromTime(i)),n.Extension.Add("Session.Id",this._sessionId),n.Extension.Add("Session.State","Ended"),this._sessionId=null,this._sessionStartTime=0}n.Extension.Add("Session.FirstLaunchTime",this._getISOString(new Date(p.firstLaunchTime))),this._addPropertiesAndSendEvent(n,t)},e.prototype.getSessionId=function(){return this._sessionId},e.prototype.setContext=function(e,t,n){this._contextProperties.setProperty(e,t,n)},e.prototype.getSemanticContext=function(){return this._semanticContext},e.prototype._getSessionDurationFromTime=function(e){return e<0?"Undefined":e<=3?"UpTo3Sec":e<=10?"UpTo10Sec":e<=30?"UpTo30Sec":e<=60?"UpTo60Sec":e<=180?"UpTo3Min":e<=600?"UpTo10Min":e<=1800?"UpTo30Min":"Above30Min"},e.prototype._createEventRecord=function(e,t){var n=new r.datamodels.Record;t||(t="custom"),n.EventType=e.toLowerCase(),n.Type=t.toLowerCase(),n.Extension.Add("EventInfo.Source","JS_default_source"),n.Extension.Add("EventInfo.InitId",this._initId),n.Extension.Add("EventInfo.Sequence",g._getSequenceForToken(this._tenantToken).toString()),n.Extension.Add("EventInfo.Name",e.toLowerCase());var i=new Date;return n.Timestamp=r.datamodels.utils.GetTimeStampWithValue(i.getTime()),n.Extension.Add("EventInfo.Time",this._getISOString(i)),n.Extension.Add("EventInfo.SdkVersion","ACT-Web-JS-"+T.version),n},e.prototype._getISOString=function(e){function t(e){return e<10?"0"+e:e.toString()}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+function(e){return e<10?"00"+e:e<100?"0"+e:e.toString()}(e.getUTCMilliseconds())+"Z"},e.prototype._addCustomPropertiesToEvent=function(e,t){this._addSemanticContext(e,p.semanticContext),this._addSemanticContext(e,g._semanticContext),this._addSemanticContext(e,this._semanticContext),this._sessionId&&e.Extension.Add("Session.Id",this._sessionId),this._addEventPropertiesToEvent(e,g._contextProperties),this._addEventPropertiesToEvent(e,this._contextProperties),this._addEventPropertiesToEvent(e,t)},e.prototype._addSemanticContext=function(e,t){if(t&&t.contextMap){var n=t.contextMap;for(var i in t.contextMap)"UserInfo.Id"==i&&t.piiKind!=r.datamodels.PIIKind.NotSet?e.AddOrReplacePII(i,n[i],t.piiKind):e.Extension.AddOrReplace(i,n[i])}},e.prototype._addEventPropertiesToEvent=function(e,t){if(t){t.timestamp&&t.timestamp>=new Date("1/1/2000").getTime()&&(e.Timestamp=r.datamodels.utils.GetTimeStampWithValue(t.timestamp),e.Extension.AddOrReplace("EventInfo.Time",this._getISOString(new Date(t.timestamp)))),t.name&&(e.EventType=t.name.toLowerCase(),e.Extension.AddOrReplace("EventInfo.Name",t.name.toLowerCase()));var n=t.properties;if(n)for(var i in n)i&&(n[i].value||!1===n[i].value||0==n[i].value||""==n[i].value)&&(s._isPii(n[i].pii)?(e.AddOrReplacePII(i,n[i].value.toString(),n[i].pii),e.Extension.Remove(i)):(e.Extension.AddOrReplace(i,n[i].value.toString()),e.PIIExtensions.Remove(i)))}},e.prototype._addPropertiesAndSendEvent=function(e,t){this._addCustomPropertiesToEvent(e,t),g.isInitialized()&&(this._sanitizeName(e),i.SendAsync(this._tenantToken,[e]))},e.prototype._sanitizeName=function(e){var t=e.EventType.replace(/\./g,"_");e.EventType=t,e.Extension.AddOrReplace("EventInfo.Name",t)},e}();r.Logger=h}(r.telemetry||(r.telemetry={}))}(n.applications||(n.applications={}))}(A||(A={})),"undefined"!=typeof module&&(module.exports=A.applications.telemetry);var N='<style>#bing-na-feedback{color:#000;overflow:auto;font-size:15px;float:right;position:relative;display:none;z-index:999;padding-right:5px;width:100%;height:100%;background:rgba(0,0,0,.8);cursor:default}.bing-na-enablefeedback:hover #bing-na-feedback-button{display:block}#bing-na-feedback-button{position:absolute;right:0;padding:8px;margin:2px;z-index:1000;display:none;background:url(http://h6.msn.com/nativeads/img/bing_sprite.png);background-position:-149px -35px;width:16px}#bing-na-feedback-undo{position:absolute;right:0;padding:8px;margin:2px;z-index:1000;display:none;text-decoration:underline;font-size:11px}#bing-na-feedback-menu{background:#fff;border:1px solid #fff;width:120px;position:relative;top:20px;float:right;cursor:pointer;font-size:12px;border-radius:4px;cursor:default;display:none}#bing-na-feedback-button:hover #bing-na-feedback{display:block}.bing-na-feedback-option{color:#000;margin:10px 5px;cursor:pointer}.bing-na-feedback-option input{vertical-align:text-bottom;margin-right:3px}.bing-na-feedback-heading{line-height:20px;margin-top:5px;padding:0 7px}</style><div class="metadata" id="bing-na-feedback-button"></div><div class="metadata" id="bing-na-feedback-undo">Undo</div><div id="bing-na-feedback" class="metadata"><div class="metadata" id="bing-na-feedback-menu"><div class="metadata bing-na-feedback-heading"><strong>Your feedback</strong></div><div class="metadata bing-na-feedback-option" feedbacktag="option" id="badimage"><input type="radio"> <span>Bad Image</span></div><div class="metadata bing-na-feedback-option" feedbacktag="option" id="irrelevantad"><input type="radio"> <span>Irrelevant Ad</span></div><div class="metadata bing-na-feedback-option" feedbacktag="option" id="offensivead"><input type="radio"> <span>Offensive Ad</span></div></div></div>';initializeAppear=function(e){var t=[],n=[],r=null,i=!1;e.fn.onappear=function(e,n,i,o){return t.push({selector:e,targetWindow:n,percentInView:i,action:o}),null==r&&(r=setInterval(process,500)),this},process=function(){try{if(t.length>0){for(var e=0;e<t.length;e++)n.indexOf(e)<0&&isElementInView(t[e].selector,t[e].targetWindow,t[e].percentInView)&&(n.push(e),t[e].action.call(void 0,t[e].selector,t[e].targetWindow));t.length==n.length&&stopProcessing()}}catch(e){i||(i=!0,D.telemetryServiceV1.logError("AdView Computation error",e.toString()))}},isElementInView=function(e,t,n){if(100==n)return isElementFullyInView(e,t);var r=na_jQuery(t).scrollTop(),i=r+na_jQuery(t).height(),o=na_jQuery(e,t.document).offset().top,a=na_jQuery(e,t.document).height(),s=o+a,u=na_jQuery(t).scrollLeft(),l=u+na_jQuery(t).width(),d=na_jQuery(e,t.document).offset().left,c=na_jQuery(e,t.document).width(),p=d+c;if(s<=r||o>=i||p<=u||d>=l)return!1;var f=0,g=0,h=0,v=0;return r>o&&r<s&&(f=r-o),i<s&&i>o&&(h=s-i),u>d&&u<p&&(v=u-d),l<p&&l>d&&(g=p-l),(f+h)*c+(v+g)*a<=a*c*(100-n)/100},isElementFullyInView=function(e,t){if(na_jQuery(e,t.document).offset()){var n=na_jQuery(t).scrollTop(),r=n+na_jQuery(t).height(),i=na_jQuery(e,t.document).offset().top,o=i+na_jQuery(e,t.document).height();if(!(n<=i&&r>=o))return!1;var a=na_jQuery(t).scrollLeft(),s=a+na_jQuery(t).width(),u=na_jQuery(e,t.document).offset().left,l=u+na_jQuery(e,t.document).width();return u>=a&&l<=s}return!1},stopProcessing=function(){clearInterval(r),r=null}};var R=new function(){return{initialize:function(e,t){R.ads=e,R.targetWindow=t,na_jQuery?R.process():R.waitingForNaJquery=setInterval(R.waitForNaJqueryAndTriggerProcess,500)},waitForNaJqueryAndTriggerProcess:function(){na_jQuery?(R.stopWaitingForNaJquery(),R.process()):C.consoleLog("Waiting for na_jQuery")},process:function(){try{R.registerForAdView(R.ads,R.targetWindow),b.registerCarouselEvents(R.targetWindow)}catch(e){D.telemetryServiceV1.logError("Error during post process",e.toString())}},stopWaitingForNaJquery:function(){clearInterval(R.waitingForNaJquery),R.waitingForNaJquery=null},registerForAdView:function(e,t){for(var n=0;n<e.length;n++){var r=e[n],i="#"+r.id;r.feedbackToken,r.mvFeedbackUrl;na_jQuery(i,t.document).onappear(i,t,100,function(e){R.logAdView(e.replace("#","")),C.sendViewabilityFeedback(e)}),na_jQuery(i,t.document).onappear(i,t,70,function(e){R.logPartialAdView(e.replace("#",""))})}},logAdView:function(e){var t=e.split("_")[0];D.telemetryServiceV1.getPropertiesAndLogEvent("adview",t,e)},logPartialAdView:function(e){var t=e.split("_")[0];D.telemetryServiceV1.getPropertiesAndLogEvent("partialadview",t,e)},logMVFeedback:function(e,t){D.telemetryServiceV1.getPropertiesAndLogEvent("mvFeedback",t,e)}}},b=new function(){var e=null,t=null,n=null,r=null;return{registerCarouselEvents:function(i){n=na_jQuery(".na-carousel .itemContainer",i.document),e=na_jQuery(".na-carousel-button-left",i.document),t=na_jQuery(".na-carousel-button-right",i.document),r=na_jQuery(".na-autoscroll",i.document),n.length>0&&(r.onappear(".na-autoscroll",i,100,function(e,t){na_jQuery(e,t.document).animate({scrollLeft:"+=100"},1e3),na_jQuery(e,t.document).animate({scrollLeft:"-=100"},1e3)}),e.click(function(){n.animate({scrollLeft:"-=100"},{duration:1e3,complete:function(){b.toggleCarouselButtonVisibility()}})}),t.click(function(){n.animate({scrollLeft:"+=100"},{duration:1e3,complete:function(){b.toggleCarouselButtonVisibility()}})}),b.toggleCarouselButtonVisibility())},toggleCarouselButtonVisibility:function(){0==n.scrollLeft()?e.css("visibility","hidden"):e.css("visibility","visible");var r=n.get(0).scrollWidth,i=n.width(),o=n.scrollLeft();r<=Math.ceil(i+o)?t.css("visibility","hidden"):t.css("visibility","visible")}}},C=new function(){var n=/([.*+?^=!:${}()|\[\]\/\\])/g,r=null;return{isDebug:function(){return"true"==C.getQueryParam("na-debug",t.location.search)},addQueryParam:function(e,t,n){return e+=-1==e.indexOf("?")?"?":"&",e+=t+"="+n},removeQueryParam:function(e,t){if(value=this.getQueryParam(t,e),!value)return e;var n=e.replace(t+"="+value,""),r=n[n.length-1];return"?"!=r&&"&"!=r||(n=n.substring(0,n.length-1)),n=n.replace("&&","&"),n=n.replace("?&","?")},getQueryParam:function(e,t){var n=this.getQueryParams(new RegExp("^"+this.escapeRegExp(e)+"$"),t);return n&&n.length>0?n[0].value:null},getQueryParams:function(e,t){return t&&t.indexOf("?")>=0&&(t=t.substring(t.indexOf("?")+1)),this.getKeyValuePairs(e,t,"&")},getCookie:function(e,t){var n=this.getKeyValuePairs(new RegExp(this.escapeRegExp(e)),t,";");return n&&n.length>0?n[0].value:null},getKeyValuePairs:function(e,t,n){if(!t||!e||!e.test)return[];for(var r=[],i=t.split(n),o=0;o<i.length;o++){var a=i[o],s=a.indexOf("=");if(-1!=s){var u=a.substring(0,s).trim(),l=a.substring(s+1).trim();e.test(u)&&r.push({name:u,value:l})}}return r},resolveMember:function(e,t,n){if(!e||!t)return null;for(var r=e,i=t.split(n||"."),o=0,a=i.length;o<a;o++){var s=i[o],u=s.search(/\[\d+\]$/),l=null;if(-1!=u&&(l=s.substring(u),s=s.substring(0,u)),r=r[s],l){if(!r)return null;r=r[l.substring(1,l.length-1)]}if(void 0==r||null==r)return null}return r},escapeRegExp:function(e){return e?e.replace(n,"\\$1"):e},addEventListener:function(e,t,n){e.addEventListener(t,n)},getNode:function(e,t,n){try{var r=C.getAllNodes(e,t);if(null==r||0==r.length)return null;var i=r[0];return null!=n&&r.length>=n?r[n-1]:i}catch(e){return null}},checkAndGetNode:function(e,t,n){return n?C.getNode(e,n):C.getNode(e,t)},getAllNodes:function(e,t){try{return e.querySelectorAll(t)}catch(e){return null}},isIE9OrLower:function(){if(null==r){var t=e.createElement("div");t.innerHTML="\x3c!--[if lte IE 9]><i></i><![endif]--\x3e",noOfElements=t.getElementsByTagName("i").length,r=1==t.getElementsByTagName("i").length}return r},getComputedStyle:function(e){return t.getComputedStyle(e)},copyArray:function(e){return Array.prototype.slice.call(e,0)},getBigId:function(e){if(!e)return"";var t=e.indexOf("?"),n=-1==t?e:e.substring(0,t),r=-1==t?"":e.substring(t),i=C.getQueryParam("productid",r);return i||(i=n.substring(n.lastIndexOf("/")+1)),i},copyObject:function(e){var t={};for(var n in e)t[n]=e[n];return t},generateGuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},JSONstringify:function(e){return"function"==typeof JSON.stringify?JSON.stringify(e):JSON.serialize(e)},JSONparse:function(e){return"function"==typeof JSON.parse?JSON.parse(e):na_jQuery.parseJSON(e)},loadScript:function(t,n){var r=e.getElementsByTagName("head")[0],i=e.createElement("script");i.type="text/javascript",i.src=t,i.onload=n,i.onreadystatechange=function(){"complete"==this.readyState&&n()},r.appendChild(i)},getMetaContentByName:function(e,n){try{n||(n=t);for(var r=n.document.getElementsByTagName("meta"),i=0;i<r.length;i++)if(r[i].getAttribute("name")==e)return r[i].getAttribute("content");return""}catch(e){return""}},getMetaContentByProperty:function(e,n){try{n||(n=t);for(var r=n.document.getElementsByTagName("meta"),i=0;i<r.length;i++)if(r[i].getAttribute("property")==e)return r[i].getAttribute("content");return""}catch(e){return""}},consoleLog:function(e){this.isDebug&&console.log(e)},removeDuplicates:function(e){return e.filter(function(t,n){return e.indexOf(t)==n})},AddTagToElement:function(t,n,r){var i=e.createAttribute(n);i.value=r,t.attributes.setNamedItem(i)},processImageCustom:function(e){for(var t=0,n=e.length;t<n;t++){var r=e[t].images;if(r)for(var t=0,n=r.length;t<n;t++)r[t].imageUrl=C.modifyImageUrl(r[t].imageUrl)}},modifyImageUrl:function(e){var t=e;try{if(e.indexOf("pid=AdsDAM")>0){var n="https://api.am.bingads.microsoft.com/images/"+C.getQueryParam("id",e).replace("OADD.",""),r=new XMLHttpRequest;r.open("GET",n,!1),r.send(null),200===r.status&&(t=C.JSONparse(r.responseText).fileLinks[0].httpsUrl)}}catch(e){}return t},isMSNHomepage:function(e){return!!e&&(e=e.replace("en-us",""),!((e=e.replaceAll("/",""))&&e.length>0))},createMVFeedbackUrl:function(e,t){if(void 0!==e&&null!==e){var n=e.split("_");if(n[1]||""==n[1]){var r=n[1].split("-")[0];return t.replace("{placeholder}",r)}}},sendViewabilityFeedback:function(e){if(w){var t=e.replace("#",""),n=t.split("_")[0],r=P.data.adRequests[n].ads[t].mvFeedbackUrl;D.httpService.send("GET",r,null,function(e,t){}),R.logMVFeedback(t,n)}},sendImpressionFeedback:function(e,t){var n=0,r=0,i=0,o="",a="",s="",u="";e.forEach(function(e){var t=e.split("_");t&&"ML"==t[0]?(o=0==n?e:o+":"+e,n++):t&&"SB"==t[0]?(a=0==r?e:a+":"+e,r++):t&&"BT"==t[0]&&(s=0==i?e:s+":"+e,i++)}),n>0&&(u=o),r>0&&(u=""!=u?u+"::"+a:a),i>0&&(u=""!=u?u+"::"+s:s);var l=t.replace("{placeholder}",u);D.httpService.send("GET",l,null,function(e,t){}),P.addProperty("miFeedbackUrl",l)},inIframe:function(){try{return t.self!==t.top}catch(e){return!0}}}};String.prototype.replaceAll=function(e,t){return this.toString().replace(new RegExp(C.escapeRegExp(e),"g"),t)};var O,B=[],P=new function(){this.data={host:t.location.host,url:t.location.href,naClientGuid:t.naClientGuid,screenHeight:t.screen.height,screenWidth:t.screen.width,userAgent:navigator.userAgent,naClientVersion:t.naClientVersion?t.naClientVersion:"unknown",referrer:e.referrer,adRequests:{}},this.addProperty=function(e,t){this.data[e]=t},this.addRequestProperty=function(e,t,n){var r=this.data.adRequests[e]||{};r[t]=n,this.data.adRequests[e]=r},this.addAdProperties=function(e,t,n){var r=this.data.adRequests[e]||{};r.ads=r.ads||{},r.ads[t]=n,this.data.adRequests[e]=r},this.addAdProperty=function(e,t,n,r){var i=this.data.adRequests[e]||{};i.ads=i.ads||{},i.ads[t]=i.ads[t]||{},i.ads[t][n]=r},this.addLatencyProperty=function(e,t,n){var r=this.data.adRequests[e]||{},i=r.latency||{};i[t]=n,r.latency=i,this.data.adRequests[e]=r}},D={},w=!1,x=0,k={},V={preInitialize:function(e){if(void 0!==e.naContext&&void 0!==e.naContext.publisherName&&-1!=e.naContext.publisherName.indexOf("encyclopedia")){Math.floor(100*Math.random())+1<=20?(e.enableMIMVLogging=!0,e.naContext.tracingtag=e.naContext.tracingtag.concat(",mimvfeedback")):(e.enableMIMVLogging=!1,e.naContext.tracingtag=e.naContext.tracingtag.concat(",mimvfeedbackDisabled"))}U.preInitializeCustom&&(e=U.preInitializeCustom(e))},postInitialize:function(){U.postInitializeCustom&&U.postInitializeCustom()},preAdRetrieval:function(e){var n=C.getQueryParam("na-requesttype",t.location.search);return n&&"post"==n.toLowerCase()&&(e.requestType="POST"),U.preAdRetrievalCustom&&U.preAdRetrievalCustom(e),e},postAdRetrieval:function(e,t,n,r){var i={ads:e,request:t,callback:n,getAds:r};U.postAdRetrievalCustom&&U.postAdRetrievalCustom(i)},postParseAdsResponse:function(e,t,n){U.postParseAdsResponseCustom&&U.postParseAdsResponseCustom(t,n)},postEntityInsertion:function(e,t){U.postEntityInsertionCustom&&U.postEntityInsertionCustom(e,t)}},U=Object.create(k),L=Object.create(V);v(t.nativeAdsContext),t.getBingNativeAds=function(e){v(e)}}(document,window);